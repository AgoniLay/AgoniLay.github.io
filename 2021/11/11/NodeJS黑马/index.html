<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>NodeJS 黑马笔记 | AgoniLay的博客</title><meta name="keywords" content="前端,nodejs,express,MongoDB"><meta name="author" content="AgoniLay"><meta name="copyright" content="AgoniLay"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Node.jsNode.js 介绍node 作者：Ryan Dahl 为什么要学习 Node.js企业需求  具有服务端开发经验 front-end 前端 back-end 后端 全栈开发工程师 全干   基本的网站开发能力 服务端 前端 运维部署   多人社区  Node.js 是什么 &#x3D;&#x3D;Node.js® is a JavaScript runtime built on Chrome’s V8">
<meta property="og:type" content="article">
<meta property="og:title" content="NodeJS 黑马笔记">
<meta property="og:url" content="https://agonilay.github.io/2021/11/11/NodeJS%E9%BB%91%E9%A9%AC/index.html">
<meta property="og:site_name" content="AgoniLay的博客">
<meta property="og:description" content="Node.jsNode.js 介绍node 作者：Ryan Dahl 为什么要学习 Node.js企业需求  具有服务端开发经验 front-end 前端 back-end 后端 全栈开发工程师 全干   基本的网站开发能力 服务端 前端 运维部署   多人社区  Node.js 是什么 &#x3D;&#x3D;Node.js® is a JavaScript runtime built on Chrome’s V8">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img2.baidu.com/it/u=2903413025,1209967719&fm=26&fmt=auto">
<meta property="article:published_time" content="2021-11-11T02:34:52.000Z">
<meta property="article:modified_time" content="2022-04-14T06:39:18.988Z">
<meta property="article:author" content="AgoniLay">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="nodejs">
<meta property="article:tag" content="express">
<meta property="article:tag" content="MongoDB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img2.baidu.com/it/u=2903413025,1209967719&fm=26&fmt=auto"><link rel="shortcut icon" href="/img/zoro3.jpg"><link rel="canonical" href="https://agonilay.github.io/2021/11/11/NodeJS%E9%BB%91%E9%A9%AC/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?050530911bbf514fb098003dafd2a51e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NodeJS 黑马笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-04-14 14:39:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/zoro3.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://img2.baidu.com/it/u=2903413025,1209967719&amp;fm=26&amp;fmt=auto')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">AgoniLay的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">NodeJS 黑马笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-11T02:34:52.000Z" title="发表于 2021-11-11 10:34:52">2021-11-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-04-14T06:39:18.988Z" title="更新于 2022-04-14 14:39:18">2022-04-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>28分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="NodeJS 黑马笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><h2 id="Node-js-介绍"><a href="#Node-js-介绍" class="headerlink" title="Node.js 介绍"></a>Node.js 介绍</h2><p>node 作者：Ryan Dahl</p>
<h3 id="为什么要学习-Node-js"><a href="#为什么要学习-Node-js" class="headerlink" title="为什么要学习 Node.js"></a>为什么要学习 Node.js</h3><p>企业需求</p>
<ul>
<li>具有服务端开发经验</li>
<li>front-end 前端</li>
<li>back-end 后端</li>
<li>全栈开发工程师<ul>
<li>全干</li>
</ul>
</li>
<li>基本的网站开发能力<ul>
<li>服务端</li>
<li>前端</li>
<li>运维部署</li>
</ul>
</li>
<li>多人社区</li>
</ul>
<h3 id="Node-js-是什么"><a href="#Node-js-是什么" class="headerlink" title="Node.js 是什么"></a>Node.js 是什么</h3><ul>
<li>==Node.js® is a JavaScript runtime built on <a target="_blank" rel="noopener" href="https://v8.dev/">Chrome’s V8 JavaScript engine</a>.==<ul>
<li>Node.js 不是一门语言</li>
<li>Node.js 不是库、不是框架</li>
<li><strong>Node.js 是一个基于 Chorme V8 引擎的 JavaScript 运行时环境</strong></li>
<li>简单来说，Node.js 可以解析和执行 JavaScript 代码</li>
<li>以前只有浏览器可以解析执行 JavaScript 代码</li>
<li>现在的 JavaScript 可以完全脱离浏览器来运行，一切都归功于：Node.js</li>
</ul>
</li>
<li>浏览器中的 JavaScript：<ul>
<li>ECMAScript<ul>
<li>基本的语法：if、var、function、Object、Array…</li>
</ul>
</li>
<li>BOM</li>
<li>DOM</li>
</ul>
</li>
<li>Node.js 中的 JavaScript：<ul>
<li><strong>没有 BOM 、DOM</strong></li>
<li>在 Node.js 执行环境中为 JavaScript 提供了一些服务器级别的操作 API<ul>
<li>文件的读写</li>
<li>网络服务的构建</li>
<li>网络通信</li>
<li>http 服务器 等处理…</li>
</ul>
</li>
</ul>
</li>
<li>构建于 Chrome 的 V8 引擎之上<ul>
<li>代码只是具有特定格式的字符串而已</li>
<li>引擎可以认识它，引擎可以帮你去解释和执行</li>
<li>Google Chorme 的 V8 引擎是目前公认解析执行 JavaScript 代码最快最高效的</li>
<li>Node.js 的作者把 Google Chorme 中的 V8 引擎移植了出来，开发了一个独立的 JavaScript 运行时环境</li>
</ul>
</li>
<li>==Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient.==<ul>
<li>event-driven 事件驱动</li>
<li>non-blocking I/O model 非阻塞 IO 模型（异步）</li>
<li>lightweight and efficient 轻量和高效</li>
</ul>
</li>
<li>==Node.js‘ package ecosystem, npm, is the largest ecosystem of open source libraries in the world.==<ul>
<li>npm 是世界上最大的开源库生态系统</li>
<li>绝大多数 JavaScript 相关的包都存放在了 npm 上，这样做的目的是为了开发人员更方便的去下载使用<br><code>npm install jquery</code></li>
</ul>
</li>
</ul>
<h3 id="Node-js-能做什么"><a href="#Node-js-能做什么" class="headerlink" title="Node.js 能做什么"></a>Node.js 能做什么</h3><ul>
<li>Web 服务器后台</li>
<li>命令行工具<ul>
<li>如：npm(node)、git(c 语言)、hexo(node) …</li>
</ul>
</li>
<li>对于前端开发工程师来将，接触 node 最多的是它的命令行工具<ul>
<li>webpack、gulp、npm…</li>
</ul>
</li>
</ul>
<h3 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h3><ul>
<li>HTML</li>
<li>CSS</li>
<li>JavaScript</li>
<li>简单的命令行操作</li>
<li>具有服务端开发经验更佳</li>
</ul>
<h3 id="一些资源"><a href="#一些资源" class="headerlink" title="一些资源"></a>一些资源</h3><ul>
<li>《深入浅出 Node.js》<ul>
<li>朴灵，偏理论，理解原理底层</li>
</ul>
</li>
<li>《Node.js 权威指南》<ul>
<li>API 讲解</li>
</ul>
</li>
<li>JavaScript 标准参考教程：<a target="_blank" rel="noopener" href="http://javascript.ruanyifeng.com/">http://javascript.ruanyifeng.com</a></li>
<li>Node 入门：<a target="_blank" rel="noopener" href="http://www.nodebeginner.org/index-zh-cn.html">http://www.nodebeginner.org/index-zh-cn.html</a></li>
<li>官方 API 文档：<a target="_blank" rel="noopener" href="https://nodejs.org/dist/latest-v6.x/docs/api">https://nodejs.org/dist/latest-v6.x/docs/api</a></li>
<li>CNode：<a target="_blank" rel="noopener" href="http://cnodejs.org/">http://cnodejs.org</a></li>
</ul>
<h3 id="这门课程你能学到啥？"><a href="#这门课程你能学到啥？" class="headerlink" title="这门课程你能学到啥？"></a>这门课程你能学到啥？</h3><ul>
<li>B/S 编程模型<ul>
<li>Browser - Server</li>
<li>back-end</li>
<li>任何服务器端技术这种 BS 编程模型都是一样，和语言无关</li>
<li>Node 只是作为我们学习 BS 编程模型的一个工具而已</li>
</ul>
</li>
<li>模块化编程<ul>
<li>RequireJS</li>
<li>SeaJS</li>
</ul>
</li>
<li>Node 常用 API</li>
<li>异步编程<ul>
<li>回调函数、Promise、async、generator …</li>
</ul>
</li>
<li>Express Web 开发框架</li>
<li>ECMAScript 6</li>
</ul>
<h2 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h2><h3 id="安装-Node-环境"><a href="#安装-Node-环境" class="headerlink" title="安装 Node 环境"></a>安装 Node 环境</h3><ul>
<li><p>查看当前 Node 环境的版本号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node --version</span><br><span class="line">node -v</span><br></pre></td></tr></table></figure></li>
<li><p>下载：<a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a></p>
</li>
<li><p>安装：</p>
<ul>
<li>傻瓜式的一路 <code>next</code> 就 OK</li>
<li>对于已经安装过的，安装新版会直接覆盖</li>
</ul>
</li>
<li><p>环境变量</p>
</li>
</ul>
<h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><h4 id="解析执行-JavaScript"><a href="#解析执行-JavaScript" class="headerlink" title="解析执行 JavaScript"></a>解析执行 JavaScript</h4><ol>
<li>创建编写 JavaScript 脚本文件</li>
<li>打开终端，定位到脚本文件所属目录</li>
<li>输入 <code>node 文件名</code> 执行对应文件</li>
</ol>
<h4 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h4><p>文件读取：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浏览器中的 JavaScript 是没有文件操作的能力的</span></span><br><span class="line"><span class="comment">// 但是 Node 中的 JavaScript 具有文件操作的能力</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fs 是 file-system 的简写,就是文件系统的意思</span></span><br><span class="line"><span class="comment">// 在 Node 中如果想要进行文件操作，就必须引入 fs 这个核心模块</span></span><br><span class="line"><span class="comment">// 在 fs 这个核心模块中，就提供了所有的文件操作相关的 API</span></span><br><span class="line"><span class="comment">// 例如：fs.readFile 就是用来读取文件的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 使用 require 方法加载 fs 核心模块</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 读取文件</span></span><br><span class="line"><span class="comment">//    第一个参数就是要读取的文件路径</span></span><br><span class="line"><span class="comment">//    第二个参数是一个回调函数</span></span><br><span class="line"><span class="comment">//      成功</span></span><br><span class="line"><span class="comment">//        data 数据</span></span><br><span class="line"><span class="comment">//        error null</span></span><br><span class="line"><span class="comment">//      失败</span></span><br><span class="line"><span class="comment">//        data undefined 没有数据</span></span><br><span class="line"><span class="comment">//        error 错误对象</span></span><br><span class="line">fs.readFile(<span class="string">&quot;./data/hello.txt&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// &lt;Buffer e9 83 91 e4 bd b3 e4 b8 bd e7 8c aa e5 a4 b4&gt;</span></span><br><span class="line">  <span class="comment">// 文件中存储的其实都是二进制数据 0 1</span></span><br><span class="line">  <span class="comment">// 这里看到的不是 0 和 1 是因为转为了 16 进制</span></span><br><span class="line">  <span class="comment">// 可以使用 toString() 方法转为我们认识的字符</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在这里就可以通过判断 error 来确认是否有错误发生</span></span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="comment">// console.log(error)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;读取文件失败了&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>文件写入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数：文件路径</span></span><br><span class="line"><span class="comment">// 第二个参数：文件内容</span></span><br><span class="line"><span class="comment">// 第三个参数：回调函数</span></span><br><span class="line"><span class="comment">//    文件写入成功： error 是 null</span></span><br><span class="line"><span class="comment">//    文件写入失败： error 就是错误对象</span></span><br><span class="line">fs.writeFile(</span><br><span class="line">  <span class="string">&quot;./data/hello.md&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Hello everyone, I am AgoniLay.&quot;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;写入失败&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="http"><a href="#http" class="headerlink" title="http"></a>http</h4><p>最简单的 http 服务：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 加载 http 核心模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用 http.createServer() 方法创建一个 Web 服务器</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 注册 request 请求事件</span></span><br><span class="line">server.on(<span class="string">&quot;request&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;收到客户端的请求了&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 绑定端口号，启动服务器</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功了，可以通过 http://127.0.0.1:3000/ 来访问&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<img src="/2021/11/11/NodeJS%E9%BB%91%E9%A9%AC/image-20211021173440069.png" class title="image-20211021173440069">

<h2 id="Node-中的-JavaScript"><a href="#Node-中的-JavaScript" class="headerlink" title="Node 中的 JavaScript"></a>Node 中的 JavaScript</h2><h3 id="ECMAScript"><a href="#ECMAScript" class="headerlink" title="ECMAScript"></a>ECMAScript</h3><ul>
<li>没有 DOM、BOM</li>
</ul>
<h3 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h3><p>核心模块是由 Node 提供的一个个的具名的模块。它们都有自己特殊的名称表示。</p>
<p>Node 为 JavaScript 提供了很多服务器级别的 API，这些 API 绝大多数都被包装到了一个具名的核心模块中了，例如：</p>
<ul>
<li>fs：文件操作模块</li>
<li>http：网络服务构建模块</li>
<li>os：操作系统信息模块</li>
<li>path：路径处理模块</li>
<li>url：url 地址模块</li>
</ul>
<p>若要使用则需要：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="模块系统"><a href="#模块系统" class="headerlink" title="模块系统"></a>模块系统</h3><p>在 Node 中没有全局作用域的概念，而是模块作用域。</p>
<p>在 Node 中，只能通过 require 方法来加载执行多个 JavaScript 脚本文件</p>
<p>require 加载只能是执行其中的代码，文件与文件之间由于是模块作用域，所以不会有污染的问题</p>
<ul>
<li>外部访问不到内部</li>
<li>内部也访问不到外部</li>
<li>默认都是封闭的</li>
</ul>
<p>require 方法有两个作用：</p>
<ol>
<li>加载文件模块，并执行里面的代码</li>
<li>拿到被加载文件模块导出的接口对象</li>
</ol>
<p>每个文件模块中都提供了一个对象 exports，exports 默认是一个空对象，需要做的是将所有需要被外部访问的成员</p>
<h2 id="Web-服务器开发"><a href="#Web-服务器开发" class="headerlink" title="Web 服务器开发"></a>Web 服务器开发</h2><h3 id="ip-地址和端口号"><a href="#ip-地址和端口号" class="headerlink" title="ip 地址和端口号"></a>ip 地址和端口号</h3><ul>
<li>IP 地址用来定位计算机</li>
<li>端口号用来定位具体的应用程序</li>
<li>所有需要联网通信的应用程序都会占用一个端口号</li>
<li>端口号的范围从 0 - 65536 之间</li>
<li>在计算机中有一些默认端口号，最好不要去使用<ul>
<li>例如 http 服务的 80</li>
</ul>
</li>
<li>可以同时给 hi 开启多个服务，但一定要确保不同服务占用的端口号不一致才可以</li>
</ul>
<h3 id="Content-Type"><a href="#Content-Type" class="headerlink" title="Content-Type"></a>Content-Type</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resquest.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html; charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>不同的资源对应的 Content-Type 是不一样的，具体参照：<a target="_blank" rel="noopener" href="https://tool.oschina.net/commons">https://tool.oschina.net/commons</a></li>
<li>图片不需要指定编码（charset）</li>
<li>一般为字符数据才指定编码</li>
</ul>
<h4 id="客户端渲染和客户端渲染"><a href="#客户端渲染和客户端渲染" class="headerlink" title="客户端渲染和客户端渲染"></a>客户端渲染和客户端渲染</h4><ul>
<li>客户端渲染不利于 SEO 搜索引擎优化</li>
<li>服务端渲染可以被爬虫抓取到的，客户端异步渲染是很难被爬虫抓取到的</li>
</ul>
<h3 id="301-和-302-重定向"><a href="#301-和-302-重定向" class="headerlink" title="301 和 302 重定向"></a>301 和 302 重定向</h3><p>3xx 开头的状态码为重定向</p>
<ul>
<li>301 永久重定向，浏览器会记住</li>
<li>302 临时重定向</li>
</ul>
<h2 id="Node-中的模块系统"><a href="#Node-中的模块系统" class="headerlink" title="Node 中的模块系统"></a>Node 中的模块系统</h2><h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><h3 id="CommonJS-模块规范"><a href="#CommonJS-模块规范" class="headerlink" title="CommonJS 模块规范"></a>CommonJS 模块规范</h3><p>加载 require</p>
<p>导出 exports</p>
<h4 id="原理解析"><a href="#原理解析" class="headerlink" title="原理解析"></a>原理解析</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 Node 中，每个模块内部都有一个自己的 module 对象</span></span><br><span class="line"><span class="comment">// 该 module 对象中，有一个成员叫 exports 也是一个对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var module = &#123;</span></span><br><span class="line"><span class="comment">//   exports: &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在模块中还有这么一句代码</span></span><br><span class="line"><span class="comment">// exports 和 module.exports 指向同一个引用</span></span><br><span class="line"><span class="comment">// var exports = module.exports</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 两者一致，那就说明，可以使用任意一方来导出</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">exports</span> === <span class="built_in">module</span>.exports); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接给 exports 赋值不管用</span></span><br><span class="line"><span class="built_in">exports</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="comment">// 最后 return 的是 module.export</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认在代码的最后有一句</span></span><br><span class="line"><span class="comment">// return module.exports</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>要注意 exports 和 modules.export 的区别</p>
</blockquote>
<h4 id="require-加载规则"><a href="#require-加载规则" class="headerlink" title="require 加载规则"></a>require 加载规则</h4><blockquote>
<p>参考书籍资料：《深入浅出 Node.js》深入 Node.js 的模块机制</p>
</blockquote>
<ul>
<li>优先从缓存加载</li>
<li>判断模块标识<ul>
<li>核心模块</li>
<li>第三方模块</li>
<li>自己写的模块</li>
</ul>
</li>
</ul>
<p>路径形式的模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路径形式的模块:</span></span><br><span class="line"><span class="comment">//  ./</span></span><br><span class="line"><span class="comment">//  ../</span></span><br><span class="line"><span class="comment">//  /xxx</span></span><br><span class="line"><span class="comment">//  首位的 / 在这里表示的是当前文件模块所属磁盘根路径\</span></span><br><span class="line"><span class="comment">//  .js 后缀名可以省略,但 ./ 不能省略</span></span><br><span class="line"><span class="comment">// require(&#x27;./foo.js&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>非路径形式的模块标识</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 核心模块的本质也是文件</span></span><br><span class="line"><span class="comment">// 核心模块文件已经被编译到二进制文件中了</span></span><br><span class="line"><span class="comment">// require(&#x27;fs&#x27;)</span></span><br><span class="line"><span class="comment">// require(&#x27;http&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三方模块</span></span><br><span class="line"><span class="comment">// 凡是第三方模块都必须通过 npm 来瞎子</span></span><br><span class="line"><span class="comment">// 使用的是由就可以通过 require(&#x27;包名) 的方式来进行加载才可以使用</span></span><br><span class="line"><span class="comment">// 既不是核心模块也不是路径形式的模块</span></span><br><span class="line"><span class="comment">//    先找到当前文件所处目录的 node_modules 目录</span></span><br><span class="line"><span class="comment">//    然后找 相对应的包名</span></span><br><span class="line"><span class="comment">//    再找 该包下的 package.json 文件</span></span><br><span class="line"><span class="comment">//    再文件里面找 main 属性:记录了 该模块的入口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    如果 package.json 文件不存在或者 main 指定的文件入口模块没有，</span></span><br><span class="line"><span class="comment">//    则 node 会自动寻找 模块中的 index.js // 作为默认备选项</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    如果以上所有任何一个条件不成立，则会进入上一级目录中的 node_modules 目录查找，规则照旧，依次反复</span></span><br><span class="line"><span class="comment">//    直到当前磁盘根目录还找不到，最后报错：</span></span><br><span class="line"><span class="comment">//      Error: Cannot find module &#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h3><p>npm（node package manager），node 的包管理器</p>
<p>官方网址：<a target="_blank" rel="noopener" href="http://www.npmjs.com/">http://www.npmjs.com</a></p>
<p>npm 就是一个命令行工具，安装了 node 就已经安装了 npm</p>
<p>可以再命令行查看版本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm --version</span><br></pre></td></tr></table></figure>

<p>升级 npm（自己升级自己）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --global npm</span><br></pre></td></tr></table></figure>

<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p>npm init</p>
<ul>
<li><code>npm init -y</code> 可以跳过向导，快速生成</li>
</ul>
<p>npm install</p>
<ul>
<li><code>npm install</code>：一次性把 dependencies 选项中的依赖项全部安装</li>
<li><code>npm install 包名</code>：只下载</li>
<li><code>npm install --save 包名</code>：下载并且保存依赖项<ul>
<li>保存到 package.json 文件中的 dependencies 选项</li>
<li>简写：<code>npm i -S 包名</code></li>
</ul>
</li>
<li><code>npm uninstall 包名</code>：只删除，有依赖项依然会保存<ul>
<li>简写：<code>npm un 包名</code></li>
</ul>
</li>
<li><code>npm uninstall --save 包名</code>：删除同时将依赖信息也去除<ul>
<li>简写：<code>npm un -S 包名</code></li>
</ul>
</li>
<li><code>npm --help</code> &amp;&amp; <code>npm help</code>：查看使用帮助<ul>
<li><code>npm 命令 --help</code>：查看具体命令的使用帮助</li>
</ul>
</li>
</ul>
<h4 id="解决-npm-被墙问题"><a href="#解决-npm-被墙问题" class="headerlink" title="解决 npm 被墙问题"></a>解决 npm 被墙问题</h4><p>npm 存储包文件的服务器在国外，有时候会被墙，速度很慢。</p>
<p><a target="_blank" rel="noopener" href="http://npm.taobao.org/">http://npm.taobao.org</a> 淘宝的开发团队把 npm 在国内做了一个备份。</p>
<p>安装淘宝的 cnpm：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在任意目录执行都可以</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --global 表示安装到全局，而非当前目录</span></span><br><span class="line">npm install --global cnpm</span><br></pre></td></tr></table></figure>

<p>接下来你安装包的时候把之前的 <code>npm</code> 替换成 <code>cnpm</code>。</p>
<p>如果不想安装 cnpm 又想使用淘宝的服务器来下载：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jquery --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>但上面命令需要每一次手动添加参数很麻烦，所以可以把这个选项加入配置文件中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>只要经过了上面命令的配置，则以后所有的 <code>npm install </code> 都会默认通过淘宝的服务器来下载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 npm 配置信息</span></span><br><span class="line">npm config list</span><br></pre></td></tr></table></figure>

<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>建议每一个项目都要有一个 <code>package.json</code> 文件（包描述文件）。</p>
<p>可以自动初始化：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">❯ npm init</span><br><span class="line">This utility will walk you through creating a package.json file.</span><br><span class="line">It only covers the most common items, and tries to guess sensible defaults.</span><br><span class="line"></span><br><span class="line">See `npm help init` for definitive documentation on these fields</span><br><span class="line">and exactly what they do.</span><br><span class="line"></span><br><span class="line">Use `npm install &lt;pkg&gt;` afterwards to install a package and</span><br><span class="line">save it as a dependency in the package.json file.</span><br><span class="line"></span><br><span class="line">Press ^C at any time to quit.</span><br><span class="line">package name: (npm-demo)</span><br><span class="line">version: (1.0.0) 0.0.1</span><br><span class="line">description: 这是一个测试项目</span><br><span class="line">entry point: (index.js) main.js</span><br><span class="line">test command:</span><br><span class="line">git repository:</span><br><span class="line">keywords:</span><br><span class="line">author: AgoniLay</span><br><span class="line">license: (ISC)</span><br><span class="line">About to write to F:\课堂笔记\web-pink\nodejs\nodejs黑马\03\code\npm-demo\package.json:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;npm-demo&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.0.1&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;这是一个测试项目&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;main.js&quot;,</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;author&quot;: &quot;AgoniLay&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Is this OK? (yes) yes</span><br><span class="line">❯ npm i jquery --save</span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">npm WARN npm-demo@0.0.1 No repository field.</span><br><span class="line"></span><br><span class="line">+ jquery@3.6.0</span><br><span class="line">added 1 package from 1 contributor in 0.414s</span><br><span class="line">❯</span><br></pre></td></tr></table></figure>

<p>目前最有用的是 <code>dependencies</code> 选项，可以用来帮我们保存第三方包的依赖信息。</p>
<ul>
<li>建议每个项目的根目录下都有一个 package.json 文件</li>
<li>建议执行 <code>npm install 包名 </code> 的时候都加上 <code>--save</code> 这个选项，目的是用来保存依赖项信息</li>
</ul>
<p>如果 <code>node_modules</code> 删除或丢失了也不用担心，只需要 <code>npm install</code> 就会自动把 <code>package.json</code> 中的 <code>dependencies</code> 中所有的依赖项 iang 都下载回来。</p>
<h3 id="package-json-和-package-lock-json"><a href="#package-json-和-package-lock-json" class="headerlink" title="package.json 和 package-lock.json"></a>package.json 和 package-lock.json</h3><p>npm 5 以前是不会有 <code>package-lock.json</code> 这个文件的，npm 5 以后才添加的。</p>
<p>当安装包时，npm 都会生成或者更新 <code>package-lock.json</code></p>
<ul>
<li>npm 5 以后的版本安装包时，不需要加 <code>--save</code> 参数，它会自动保存依赖信息；</li>
<li>当你安装包时，会自动生成 <code>package-lock.json</code> 这个文件<ul>
<li>这个文件会保存 <code>node_modules</code> 中所有包的信息（版本，下载地址），起到使 <code>npm install</code> 时<strong>速度提升</strong>的作用；</li>
<li>从文件来看，有一个 <code>lock</code>，这个 lock 是用来锁定版本的</li>
<li>如果项目依赖了 <code>1.1.1</code> 版本，如果重新 install 其实会下载最新版本，所以这个文件的另一个作用就是<strong>锁定版本号</strong>，防止自动升级新版</li>
</ul>
</li>
</ul>
<h3 id="path-路径操作模块"><a href="#path-路径操作模块" class="headerlink" title="path 路径操作模块"></a>path 路径操作模块</h3><blockquote>
<p>参考文档：<a target="_blank" rel="noopener" href="http://nodejs.cn/api/path.html">http://nodejs.cn/api/path.html</a></p>
</blockquote>
<ul>
<li>path.basename：获取文件名（默认包含后缀名）</li>
<li>path.dirname：获取目录部分</li>
<li>path.extname：获取扩展名部分</li>
<li>path.parse：把一个路径转为对象<ul>
<li>root：根路径</li>
<li>dir：目录</li>
<li>base：包含后缀名的文件名</li>
<li>ext：后缀名</li>
<li>name：不包含后缀名的文件名</li>
</ul>
</li>
<li>path.join：路径拼接</li>
<li>path.isAbsolute：判断一个路径是否是绝对路径</li>
</ul>
<h3 id="Node-中的其他成员"><a href="#Node-中的其他成员" class="headerlink" title="Node 中的其他成员"></a>Node 中的其他成员</h3><p>在每个模块中，除了 <code>require</code>、<code>exports</code> 等模块相关 API 之外，还有两个特殊的成员：</p>
<ul>
<li><code>__dirname</code>：<strong>动态获取</strong> 可以用来获取当前文件模块所属目录的绝对路径</li>
<li><code>__filename</code>：<strong>动态获取</strong> 可以用来获取当前文件的绝对路径</li>
<li><code>__dirname</code> 和 <code>__filename</code> 是不受执行 node 命令所属路径影响的</li>
</ul>
<p>在文件操作中，使用相对路径是不可靠的，因为在 Node 中文件操作的路径被设计为相对于执行 node 命令所处的路径（不是 bug，这样设计有使用背景）。</p>
<p>解决办法就是换为绝对路径使用 <code>__dirname</code> 和 <code>__filename</code> 即可。</p>
<p>在拼接路径的过程中，为了避免手动拼接带来的一些低级错误，所以推荐多使用：<code>path.join()</code> 来辅助拼接。</p>
<p>所以为了尽量避免刚才所描述的这个问题，大家以后再文件操作中使用的相对路径都统一转换为 <strong>动态的绝对路径</strong>。</p>
<blockquote>
<p>补充：模块中的路径表示和这里的路径没关系，不受影响（相对于文件模块）</p>
</blockquote>
<h2 id="Node-目录结构"><a href="#Node-目录结构" class="headerlink" title="Node 目录结构"></a>Node 目录结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|--app.js							项目入口文件</span><br><span class="line">|--controllers</span><br><span class="line">|--models							存储使用 mongoose 设计的数据模型</span><br><span class="line">|--node_modules				第三方依赖包文件夹</span><br><span class="line">|--package.json				包描述文件</span><br><span class="line">|--package-lock.json	第三方包版本锁定文件（npm 5 以后才有）</span><br><span class="line">|--public							公共的静态资源</span><br><span class="line">|--README.md					项目说明文档</span><br><span class="line">|--routes							路由分类文件夹</span><br><span class="line">|--views							存储视图目录</span><br><span class="line">|--.gitignore</span><br></pre></td></tr></table></figure>

<h2 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h2><p>原生的 http 在某些方面表现不足以应对我们的开发需求，所以需要使用框架来加快我们的开发效率，框架的目的就是提高效率，让我们的代码高度统一。</p>
<p>express，作者：TJ，目前已到社区维护（<a target="_blank" rel="noopener" href="https://www.expressjs.com.cn/%EF%BC%89">https://www.expressjs.com.cn/）</a></p>
<h3 id="起步-1"><a href="#起步-1" class="headerlink" title="起步"></a>起步</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save express</span><br></pre></td></tr></table></figure>

<h4 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;app is running...&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="基本路由"><a href="#基本路由" class="headerlink" title="基本路由"></a>基本路由</h4><p>路由器：</p>
<ul>
<li>请求方法</li>
<li>请求路径</li>
<li>请求处理函数</li>
</ul>
<p>get：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当你以 GET 方法请求 / 的时候，执行对应的处理函数</span></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>post：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当你以 POST 方法请求 / 的时候，执行对应的处理函数</span></span><br><span class="line">app.post(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&quot;Got a POST request&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="静态服务"><a href="#静态服务" class="headerlink" title="静态服务"></a>静态服务</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当以 /public/ 开头的时候，去 ./public/ 目录中找对应的资源</span></span><br><span class="line">app.use(<span class="string">&quot;/public/&quot;</span>, express.static(<span class="string">&quot;./public/&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于给 public 起了一个别名，但不建议</span></span><br><span class="line">app.use(<span class="string">&quot;/a/&quot;</span>, express.static(<span class="string">&quot;./public/&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当省略第一个参数的时候，通过 省略 /public 的方式来访问</span></span><br><span class="line">app.use(express.static(<span class="string">&quot;./public/&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="在-Express-配置使用-art-template-模版引擎"><a href="#在-Express-配置使用-art-template-模版引擎" class="headerlink" title="在 Express 配置使用 art-template 模版引擎"></a>在 Express 配置使用 art-template 模版引擎</h3><p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save art-template</span><br><span class="line">npm install --save express-art-template</span><br></pre></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.engine(<span class="string">&quot;html&quot;</span>, <span class="built_in">require</span>(<span class="string">&quot;express-art-template&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// express 默认会去项目中的 views 目录找 index.html</span></span><br><span class="line">  res.render(<span class="string">&quot;index.html&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果希望修改默认的 views 视图渲染存储目录，可以：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：一个参数 views 是固定的，不要写错</span></span><br><span class="line">app.set(<span class="string">&quot;views&quot;</span>, <span class="string">&quot;目录路径&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Express-获取表单-POST-请求参数"><a href="#Express-获取表单-POST-请求参数" class="headerlink" title="Express 获取表单 POST 请求参数"></a>Express 获取表单 POST 请求参数</h3><p>Express 内置了一个 API，可以直接通过 <code>req.query</code> 来获取</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req.query;</span><br></pre></td></tr></table></figure>

<h3 id="Express-获取表单-POST-请求体数据"><a href="#Express-获取表单-POST-请求体数据" class="headerlink" title="Express 获取表单 POST 请求体数据"></a>Express 获取表单 POST 请求体数据</h3><p>在 express 中没有内置获取表单 POST 请求体的 API，这里是我们需要使用一个第三方包：<code>body-parser</code></p>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save body-parser</span><br></pre></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// 0. 引包</span></span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 body-parser</span></span><br><span class="line"><span class="comment">// 只要加入这个配置，则在 req 请求对象上会多出来一个属性：body</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line">  res.write(<span class="string">&quot;you posted:\n&quot;</span>);</span><br><span class="line">  res.end(<span class="built_in">JSON</span>.stringify(req.body, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Express-配置使用-express-session-插件"><a href="#Express-配置使用-express-session-插件" class="headerlink" title="Express 配置使用 express-session 插件"></a>Express 配置使用 express-session 插件</h3><blockquote>
<p>参考文档：<a target="_blank" rel="noopener" href="https://www.expressjs.com.cn/en/resources/middleware/session.html">https://www.expressjs.com.cn/en/resources/middleware/session.html</a></p>
</blockquote>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-session</span><br></pre></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该插件会为 req 请求对象添加一个成员：req.session 默认是一个对象</span></span><br><span class="line">app.use(</span><br><span class="line">  session(&#123;</span><br><span class="line">    <span class="comment">// 配置加密字符串，它会在原有加密基础之上和这个字符串拼起来去加密</span></span><br><span class="line">    <span class="comment">// 目的是为了增加安全性，防止客户端恶意伪造</span></span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&quot;AgoniLay&quot;</span>,</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">false</span>, <span class="comment">// 无论你是否使用 Session ，我都默认直接给你分配一把钥匙</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加 Session 数据</span></span><br><span class="line">req.session.foo = <span class="string">&quot;AgoniLay&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 Session 数据</span></span><br><span class="line">req.session.foo;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除 Session 数据</span></span><br><span class="line">req.session.foo = <span class="literal">null</span>; <span class="comment">// 不严谨</span></span><br><span class="line"><span class="keyword">delete</span> req.session.foo;</span><br></pre></td></tr></table></figure>

<p>提示：默认 session 数据是内存存储的，服务器一旦重启就会丢失，真正的生产环境会把 Session 进行持久化存储</p>
<h3 id="CRUD-案例"><a href="#CRUD-案例" class="headerlink" title="CRUD 案例"></a>CRUD 案例</h3><h4 id="路由设计"><a href="#路由设计" class="headerlink" title="路由设计"></a>路由设计</h4><table>
<thead>
<tr>
<th>请求方法</th>
<th>请求路径</th>
<th>get 参数</th>
<th>post 参数</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>/students</td>
<td></td>
<td></td>
<td>渲染首页</td>
</tr>
<tr>
<td>GET</td>
<td>/students/new</td>
<td></td>
<td></td>
<td>渲染添加学生界面</td>
</tr>
<tr>
<td>POST</td>
<td>/students/new</td>
<td></td>
<td>name,age,gender,hobbies</td>
<td>处理添加学生请求</td>
</tr>
<tr>
<td>GET</td>
<td>/students/edit</td>
<td>id</td>
<td></td>
<td>渲染编辑页面</td>
</tr>
<tr>
<td>POST</td>
<td>/students/edit</td>
<td></td>
<td>id,name,age,gender,hobbies</td>
<td>处理编辑请求</td>
</tr>
<tr>
<td>GET</td>
<td>/students/delete</td>
<td>id</td>
<td></td>
<td>处理删除请求</td>
</tr>
</tbody></table>
<h4 id="自己编写的步骤"><a href="#自己编写的步骤" class="headerlink" title="自己编写的步骤"></a>自己编写的步骤</h4><ol>
<li>处理模板</li>
<li>配置开放静态资源</li>
<li>配置模板引擎</li>
<li>简单路由：/student 渲染静态页出来</li>
<li>路由设计</li>
<li>提取路由模块</li>
<li>由于接下来一系列的业务操作都需要处理文件数据，所以需要封装异步方法</li>
</ol>
<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>中间件的本质就是一个请求处理方法，我们把用户从请求到响应的整个过程分发到多个中间件中去处理，这样做的目的是提高代码的灵活性，动态可扩展性。</p>
<h4 id="应用程序级别中间件"><a href="#应用程序级别中间件" class="headerlink" title="应用程序级别中间件"></a>应用程序级别中间件</h4><p>万能匹配：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Time: &quot;</span>, <span class="built_in">Date</span>.now());</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>只要是以 <code>/xxx/</code> 开头的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">&quot;/a&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Time: &quot;</span>, <span class="built_in">Date</span>.now());</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="路由级别中间件"><a href="#路由级别中间件" class="headerlink" title="路由级别中间件"></a>路由级别中间件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><h3 id="关系型数据库和非关系型数据库"><a href="#关系型数据库和非关系型数据库" class="headerlink" title="关系型数据库和非关系型数据库"></a>关系型数据库和非关系型数据库</h3><p>表就是关系</p>
<ul>
<li>所有的关系型数控都需要通过 <code>sql</code> 语言来操作</li>
<li>所有的关系型数据库在操作之前都需要设计表结构</li>
<li>而且数据表还支持约束</li>
</ul>
<p>非关系型数据库非常的灵活</p>
<ul>
<li>有的非关系型数据库就是 key-value 对儿</li>
<li>但是 MongoDB 是长的最像关系型数据库的非关系型数据库</li>
<li>MongoDB 不需要设计表结构，可以任意的往里面存数据</li>
</ul>
<h3 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h3><p>官方下载地址： <a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download">https://www.mongodb.com/try/download</a></p>
<p>需要配置环境变量 bin 目录路径</p>
<p>输入 <code>mongod --version</code> 测试是否安装成功</p>
<h3 id="启动和关闭数据库"><a href="#启动和关闭数据库" class="headerlink" title="启动和关闭数据库"></a>启动和关闭数据库</h3><p>启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mongodb 默认使用执行 mongd 命令所处盘符根目录下的 /data/db 做为自己的数据存储目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 所以在第一次执行该命令之前先手动创建一个 /data/db</span></span><br><span class="line">mongod</span><br></pre></td></tr></table></figure>

<p>如果想要修改默认的数据存储目录，可以：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo --dbpath=数据存储目录路径</span><br></pre></td></tr></table></figure>

<p>停止：</p>
<ol>
<li>在开启服务的控制台直接 ctrl + c 停止</li>
<li>关闭命令行窗口停止</li>
</ol>
<h3 id="连接和退出数据库"><a href="#连接和退出数据库" class="headerlink" title="连接和退出数据库"></a>连接和退出数据库</h3><p>连接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 该命令默认连接本机的 MongoDB 服务</span></span><br><span class="line">mongo</span><br></pre></td></tr></table></figure>

<p>退出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在连接状态输入</span></span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<h3 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h3><ul>
<li><code>show dbs</code>：查看显示所有数据库<ul>
<li><code>db</code>：查看当前连接的数据库</li>
</ul>
</li>
<li><code>use 数据库名称</code>：切换到指定的数据库（如果没有会新建）</li>
<li>插入数据：<code>db.students.insertOne(&#123;&quot;name&quot;, &quot;AgoniLay&quot;&#125;)</code></li>
<li>查看所有集合：<code>db collections</code></li>
<li>查看某集合中所有数据：<code>db.students.find()</code></li>
</ul>
<h3 id="在-Node-中如何操作-MongoDB-数据"><a href="#在-Node-中如何操作-MongoDB-数据" class="headerlink" title="在 Node 中如何操作 MongoDB 数据"></a>在 Node 中如何操作 MongoDB 数据</h3><h4 id="使用官方的-mongodb-包来操作"><a href="#使用官方的-mongodb-包来操作" class="headerlink" title="使用官方的 mongodb 包来操作"></a>使用官方的 mongodb 包来操作</h4><p>github 地址：<a target="_blank" rel="noopener" href="https://github.com/mongodb/node-mongodb-native">https://github.com/mongodb/node-mongodb-native</a></p>
<h4 id="使用第三方-mongoose-来操作-MongDB-数据库"><a href="#使用第三方-mongoose-来操作-MongDB-数据库" class="headerlink" title="使用第三方 mongoose 来操作 MongDB 数据库"></a>使用第三方 mongoose 来操作 MongDB 数据库</h4><p>第三方包：<code>mongoose</code> 基于 MongoDB 官方的 <code>mongodb</code> 包再一次做了封装</p>
<p>官网：<a target="_blank" rel="noopener" href="https://mongoosejs.com/">https://mongoosejs.com/</a></p>
<h5 id="MongoDB-的基本概念"><a href="#MongoDB-的基本概念" class="headerlink" title="MongoDB 的基本概念"></a>MongoDB 的基本概念</h5><ul>
<li>数据库</li>
<li>一个数据库中可以有多个集合（表）</li>
<li>一个集合中可以有多个文档（表记录）</li>
<li>文档结构很灵活，没有任何限制</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  qq: &#123;</span><br><span class="line">    users: [</span><br><span class="line">      &#123; name: &#x27;AgoniLay&#x27;, age: <span class="number">15</span> &#125;, &#123;&#125;...</span><br><span class="line">    ],</span><br><span class="line">    products: []</span><br><span class="line">  &#125;,</span><br><span class="line">  taobao: &#123;&#125;,</span><br><span class="line">  baidu: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="起步-2"><a href="#起步-2" class="headerlink" title="起步"></a>起步</h5><p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mongoose</span><br></pre></td></tr></table></figure>

<p>小案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接 MongoDB 数据库</span></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个模型</span></span><br><span class="line"><span class="comment">// 就是在设计数据库</span></span><br><span class="line"><span class="comment">// MongoDB 是动态的，非常灵活，只需要在代码中设计你的数据库就可以了</span></span><br><span class="line"><span class="keyword">const</span> Cat = mongoose.model(<span class="string">&quot;Cat&quot;</span>, &#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化一个 Cat</span></span><br><span class="line"><span class="keyword">const</span> kitty = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">&quot;AgoniLay&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 持久化保存 kitty 实例</span></span><br><span class="line">kitty.save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;meow&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// .then(() =&gt; console.log(&#x27;meow&#x27;))</span></span><br></pre></td></tr></table></figure>

<h5 id="官方指南"><a href="#官方指南" class="headerlink" title="官方指南"></a>官方指南</h5><h6 id="设计-Schema-发布-Model"><a href="#设计-Schema-发布-Model" class="headerlink" title="设计 Schema 发布 Model"></a>设计 Schema 发布 Model</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 连接数据库</span></span><br><span class="line"><span class="comment">// 指定连接的数据库不需要存在，当你插入第一条数据之后就会自动被创建出来</span></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/itcast&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 设计集合结构（表结构）</span></span><br><span class="line"><span class="comment">// 字段名称就是表结构中的属性名称</span></span><br><span class="line"><span class="comment">// 约束的目的是为了保证数据的完整性，不要有脏数据</span></span><br><span class="line"><span class="keyword">var</span> userSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  <span class="attr">username</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span>, <span class="comment">// 必须有</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">password</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">email</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将文档结构发布为模型</span></span><br><span class="line"><span class="comment">//    mongoose.model 方法就是用来将一个架构发布为 model</span></span><br><span class="line"><span class="comment">//    第一个参数：传入一个大写单词字符串用来表示你的数据库名称</span></span><br><span class="line"><span class="comment">//               mongoose 会自动将大写名词的字符串生成 小写复数 的集合名称</span></span><br><span class="line"><span class="comment">//               例如这里的 User 最终会变为 users 集合名称</span></span><br><span class="line"><span class="comment">//    第二个参数：架构 Schema</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    返回值：模型构造函数</span></span><br><span class="line"><span class="keyword">var</span> User = mongoose.model(<span class="string">&quot;user&quot;</span>, userSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 当我们有了模型的构造函数之后，就可以使用这个构造函数对 users 集合中的数据为所欲为了（增删改查）</span></span><br></pre></td></tr></table></figure>

<h6 id="增加数据"><a href="#增加数据" class="headerlink" title="增加数据"></a>增加数据</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = <span class="keyword">new</span> User(&#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">  <span class="attr">email</span>: <span class="string">&quot;admin@admin.com&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">user.save(<span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;保存失败&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;保存成功&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h6 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h6><p>查询所有：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">User.find(<span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(<span class="string">&quot;查询失败&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;查询成功&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>按条件查询所有：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">User.find(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&quot;AgoniLay&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(<span class="string">&quot;查询失败&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;查询成功&quot;</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>按条件查询一个：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">User.findOne(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&quot;AgoniLay&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(<span class="string">&quot;查询失败&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;查询成功&quot;</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h6 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h6><p>根据条件删除所有：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">User.remove(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>根据条件删除一个：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.findOneAndRemove(conditions, [options], [callback]);</span><br></pre></td></tr></table></figure>

<p>根据 id 删除一个：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.findByIdAndRemove(id, [options], [callback]);</span><br></pre></td></tr></table></figure>

<h6 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h6><p>根据条件更新所有：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(conditions, doc, [options], [callback]);</span><br></pre></td></tr></table></figure>

<p>根据指定条件更新一个：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.findOneAndUpdate([conditions], [update], [options], [callback]);</span><br></pre></td></tr></table></figure>

<p>根据 id 更新一个：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">User.findByIdAndUpdate(</span><br><span class="line">  <span class="string">&quot;6188a8f90f972021946da51e&quot;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&quot;020316&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;更新成功&quot;</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(data); <span class="comment">// 返回更改前数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h2><h3 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y, callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// callback 就是回调函数</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> ret = x + y;</span><br><span class="line">    callback(ret);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">10</span>, <span class="number">20</span>, <span class="function">(<span class="params">ret</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ret);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>基于原生 XMLHttpRequest 封装 get 方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    callback(xhr.responseText);</span><br><span class="line">  &#125;;</span><br><span class="line">  xhr.open(<span class="string">&quot;get&quot;</span>, url, <span class="literal">true</span>);</span><br><span class="line">  xhr.send();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">get(<span class="string">&quot;data.json&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>callback hell（回调地狱）</p>
<img src="/2021/11/11/NodeJS%E9%BB%91%E9%A9%AC/callback-hell.jpeg" class title="callback-hell">

<p>无法保证顺序的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&quot;./data/a.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="comment">// return console.log(&#x27;读取失败&#x27;)</span></span><br><span class="line">    <span class="comment">// 抛出异常</span></span><br><span class="line">    <span class="comment">//  1. 阻止程序的执行</span></span><br><span class="line">    <span class="comment">//  2. 把错误消息打印到控制台</span></span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&quot;./data/b.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&quot;./data/c.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通过回调嵌套的方式来保证顺序：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&quot;./data/a.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">  fs.readFile(<span class="string">&quot;./data/b.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    fs.readFile(<span class="string">&quot;./data/c.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">      <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>为了解决以上编码方式带来的问题（回调地狱嵌套），所以在 ECMAScript 6 中新增了一个 API：<code>Primose</code></p>
<p>Promise 基本语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  fs.readFile(<span class="string">&quot;./data/a.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 失败了，承诺容器中的任务失败了</span></span><br><span class="line">      <span class="comment">// console.log(err)</span></span><br><span class="line">      <span class="comment">// 把容器的 pending 状态改为失败 rejected</span></span><br><span class="line">      reject(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 承诺容器中的任务成功了</span></span><br><span class="line">      <span class="comment">// console.log(data)</span></span><br><span class="line">      <span class="comment">// 把容器的 pending 状态改为成功 resolved</span></span><br><span class="line">      resolve(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(</span><br><span class="line">  <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;读取文件失败了&quot;</span>, err);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>封装 Promise 版本的 <code>readFile</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pReadFile</span>(<span class="params">filePath</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    fs.readFile(filePath, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve(data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pReadFile(<span class="string">&quot;./data/a.txt&quot;</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="keyword">return</span> pReadFile(<span class="string">&quot;./data/b.txt&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="keyword">return</span> pReadFile(<span class="string">&quot;./data/c.txt&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="代码风格"><a href="#代码风格" class="headerlink" title="代码风格"></a>代码风格</h3><ul>
<li>有分号风格</li>
<li>无分号风格<ul>
<li>只需要注意以 <code>(</code> <code>[</code> `` <code>开头的语句前面要加一个</code>;`</li>
</ul>
</li>
</ul>
<h3 id="修改代码自动重启"><a href="#修改代码自动重启" class="headerlink" title="修改代码自动重启"></a>修改代码自动重启</h3><p>使用第三方工具 nodemon 来解决频繁修改代码重启服务器问题</p>
<p><code>nodemon</code> 是一个基于 Node.js 开发的一个第三方命令行工具，需要独立安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --global nodemon</span><br></pre></td></tr></table></figure>

<p>安装完毕后，使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node app.js</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 nodemon</span></span><br><span class="line">nodemon app.js</span><br></pre></td></tr></table></figure>

<p>凡是通过 <code>nodemon</code> 启动的服务，则它会监视你文件的变化，当文件发生变化时，自动重启服务器。</p>
<h3 id="文件操作路径和模块路径"><a href="#文件操作路径和模块路径" class="headerlink" title="文件操作路径和模块路径"></a>文件操作路径和模块路径</h3><p>文件操作路径：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在文件的相对路径中</span></span><br><span class="line"><span class="comment">//    ./ 和 不写 相对于当前目录</span></span><br><span class="line"><span class="comment">//    / 绝对路径，当前文件模块所处磁盘根目录</span></span><br><span class="line"><span class="comment">//    c:/xx 绝对路径</span></span><br><span class="line"><span class="comment">// Error: ENOENT: no such file or directory, open &#x27;F:\data\a.txt&#x27;</span></span><br><span class="line">fs.readFile(<span class="string">&quot;/data/a.txt&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&quot;读取失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>模块操作路径：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里如果忽略了 . 则也是磁盘根目录</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;/data/foo.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相对路径</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;./data/foo.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模块加载的路径中的相对路径不能省略 ./</span></span><br></pre></td></tr></table></figure>

<h3 id="Node-js-操作-MySql-数据库"><a href="#Node-js-操作-MySql-数据库" class="headerlink" title="Node.js 操作 MySql 数据库"></a>Node.js 操作 MySql 数据库</h3><p>使用第三方包 <code>mysql</code></p>
<p>npm 网址：<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/mysql">https://www.npmjs.com/package/mysql</a></p>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql --save</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">AgoniLay</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://agonilay.github.io/2021/11/11/NodeJS%E9%BB%91%E9%A9%AC/">https://agonilay.github.io/2021/11/11/NodeJS%E9%BB%91%E9%A9%AC/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://agonilay.github.io" target="_blank">AgoniLay的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/nodejs/">nodejs</a><a class="post-meta__tags" href="/tags/express/">express</a><a class="post-meta__tags" href="/tags/MongoDB/">MongoDB</a></div><div class="post_share"><div class="social-share" data-image="https://img2.baidu.com/it/u=2903413025,1209967719&amp;fm=26&amp;fmt=auto" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/11/JS%E6%A8%A1%E5%9D%97%E5%8C%96/"><img class="prev-cover" src="https://img0.baidu.com/it/u=392452111,1511286792&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=250" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JS模块化</div></div></a></div><div class="next-post pull-right"><a href="/2021/10/08/axios%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0/"><img class="next-cover" src="https://img1.baidu.com/it/u=760748498,104452322&amp;fm=15&amp;fmt=auto" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">axios 源码实现</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/07/29/Express%E7%AC%94%E8%AE%B0/" title="Express笔记"><img class="cover" src="https://img2.baidu.com/it/u=3257958143,4204852086&fm=26&fmt=auto" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-29</div><div class="title">Express笔记</div></div></a></div><div><a href="/2021/07/29/NodeJS%E7%AC%94%E8%AE%B0/" title="NodeJS笔记"><img class="cover" src="https://img2.baidu.com/it/u=86018983,1456692229&fm=26&fmt=auto" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-29</div><div class="title">NodeJS笔记</div></div></a></div><div><a href="/2022/04/11/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1/" title="前端面试知识总结"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fwww.xuekebaba.com%2Fuploads%2F202004%2F24%2F200424103930895.jpeg&refer=http%3A%2F%2Fwww.xuekebaba.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1652630370&t=7aa679493e509726dbb151dd49072ebe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-11</div><div class="title">前端面试知识总结</div></div></a></div><div><a href="/2021/08/28/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E5%A4%8D%E4%B9%A0/" title="前端面试复习笔记"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fwww.xuekebaba.com%2Fuploads%2F202004%2F24%2F200424103930895.jpeg&refer=http%3A%2F%2Fwww.xuekebaba.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1652630370&t=7aa679493e509726dbb151dd49072ebe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-28</div><div class="title">前端面试复习笔记</div></div></a></div><div><a href="/2022/04/20/%E9%9D%A2%E7%BB%8F%E6%80%BB%E7%BB%93/" title="面经总结"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fwww.xuekebaba.com%2Fuploads%2F202004%2F24%2F200424103930895.jpeg&refer=http%3A%2F%2Fwww.xuekebaba.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1652630370&t=7aa679493e509726dbb151dd49072ebe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-20</div><div class="title">面经总结</div></div></a></div><div><a href="/2021/08/28/%E5%89%8D%E7%AB%AF%E7%BB%BC%E5%90%88%E7%AC%94%E8%AE%B0/" title="前端综合复习笔记"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fwww.xuekebaba.com%2Fuploads%2F202004%2F24%2F200424103930895.jpeg&refer=http%3A%2F%2Fwww.xuekebaba.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1652630370&t=7aa679493e509726dbb151dd49072ebe" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-28</div><div class="title">前端综合复习笔记</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Node-js"><span class="toc-number">1.</span> <span class="toc-text">Node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-js-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">Node.js 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E4%B9%A0-Node-js"><span class="toc-number">1.1.1.</span> <span class="toc-text">为什么要学习 Node.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.2.</span> <span class="toc-text">Node.js 是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.3.</span> <span class="toc-text">Node.js 能做什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.4.</span> <span class="toc-text">预备知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E8%B5%84%E6%BA%90"><span class="toc-number">1.1.5.</span> <span class="toc-text">一些资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%97%A8%E8%AF%BE%E7%A8%8B%E4%BD%A0%E8%83%BD%E5%AD%A6%E5%88%B0%E5%95%A5%EF%BC%9F"><span class="toc-number">1.1.6.</span> <span class="toc-text">这门课程你能学到啥？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%B7%E6%AD%A5"><span class="toc-number">1.2.</span> <span class="toc-text">起步</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Node-%E7%8E%AF%E5%A2%83"><span class="toc-number">1.2.1.</span> <span class="toc-text">安装 Node 环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hello-World"><span class="toc-number">1.2.2.</span> <span class="toc-text">Hello World</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E6%89%A7%E8%A1%8C-JavaScript"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">解析执行 JavaScript</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">文件读写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">http</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-%E4%B8%AD%E7%9A%84-JavaScript"><span class="toc-number">1.3.</span> <span class="toc-text">Node 中的 JavaScript</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ECMAScript"><span class="toc-number">1.3.1.</span> <span class="toc-text">ECMAScript</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="toc-number">1.3.2.</span> <span class="toc-text">核心模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.3.3.</span> <span class="toc-text">模块系统</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91"><span class="toc-number">1.4.</span> <span class="toc-text">Web 服务器开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ip-%E5%9C%B0%E5%9D%80%E5%92%8C%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="toc-number">1.4.1.</span> <span class="toc-text">ip 地址和端口号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Content-Type"><span class="toc-number">1.4.2.</span> <span class="toc-text">Content-Type</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">客户端渲染和客户端渲染</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#301-%E5%92%8C-302-%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.4.3.</span> <span class="toc-text">301 和 302 重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.</span> <span class="toc-text">Node 中的模块系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">1.5.1.</span> <span class="toc-text">模块化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CommonJS-%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83"><span class="toc-number">1.5.2.</span> <span class="toc-text">CommonJS 模块规范</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">原理解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#require-%E5%8A%A0%E8%BD%BD%E8%A7%84%E5%88%99"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">require 加载规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#npm"><span class="toc-number">1.5.3.</span> <span class="toc-text">npm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3-npm-%E8%A2%AB%E5%A2%99%E9%97%AE%E9%A2%98"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">解决 npm 被墙问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#package-json"><span class="toc-number">1.5.4.</span> <span class="toc-text">package.json</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#package-json-%E5%92%8C-package-lock-json"><span class="toc-number">1.5.5.</span> <span class="toc-text">package.json 和 package-lock.json</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#path-%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%9D%97"><span class="toc-number">1.5.6.</span> <span class="toc-text">path 路径操作模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-%E4%B8%AD%E7%9A%84%E5%85%B6%E4%BB%96%E6%88%90%E5%91%98"><span class="toc-number">1.5.7.</span> <span class="toc-text">Node 中的其他成员</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.6.</span> <span class="toc-text">Node 目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Express"><span class="toc-number">1.7.</span> <span class="toc-text">Express</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%B7%E6%AD%A5-1"><span class="toc-number">1.7.1.</span> <span class="toc-text">起步</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hello-world"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">hello world</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%B7%AF%E7%94%B1"><span class="toc-number">1.7.1.3.</span> <span class="toc-text">基本路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.7.1.4.</span> <span class="toc-text">静态服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Express-%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8-art-template-%E6%A8%A1%E7%89%88%E5%BC%95%E6%93%8E"><span class="toc-number">1.7.2.</span> <span class="toc-text">在 Express 配置使用 art-template 模版引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%8D%95-POST-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">1.7.3.</span> <span class="toc-text">Express 获取表单 POST 请求参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%8D%95-POST-%E8%AF%B7%E6%B1%82%E4%BD%93%E6%95%B0%E6%8D%AE"><span class="toc-number">1.7.4.</span> <span class="toc-text">Express 获取表单 POST 请求体数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8-express-session-%E6%8F%92%E4%BB%B6"><span class="toc-number">1.7.5.</span> <span class="toc-text">Express 配置使用 express-session 插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRUD-%E6%A1%88%E4%BE%8B"><span class="toc-number">1.7.6.</span> <span class="toc-text">CRUD 案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.7.6.1.</span> <span class="toc-text">路由设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.7.6.2.</span> <span class="toc-text">自己编写的步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.7.7.</span> <span class="toc-text">中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%BA%A7%E5%88%AB%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.7.7.1.</span> <span class="toc-text">应用程序级别中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%BA%A7%E5%88%AB%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.7.7.2.</span> <span class="toc-text">路由级别中间件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB"><span class="toc-number">1.8.</span> <span class="toc-text">MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.8.1.</span> <span class="toc-text">关系型数据库和非关系型数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-number">1.8.2.</span> <span class="toc-text">下载安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%92%8C%E5%85%B3%E9%97%AD%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.8.3.</span> <span class="toc-text">启动和关闭数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%92%8C%E9%80%80%E5%87%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.8.4.</span> <span class="toc-text">连接和退出数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.5.</span> <span class="toc-text">基本命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Node-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%93%8D%E4%BD%9C-MongoDB-%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.6.</span> <span class="toc-text">在 Node 中如何操作 MongoDB 数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%98%E6%96%B9%E7%9A%84-mongodb-%E5%8C%85%E6%9D%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.6.1.</span> <span class="toc-text">使用官方的 mongodb 包来操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9-mongoose-%E6%9D%A5%E6%93%8D%E4%BD%9C-MongDB-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.8.6.2.</span> <span class="toc-text">使用第三方 mongoose 来操作 MongDB 数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#MongoDB-%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.8.6.2.1.</span> <span class="toc-text">MongoDB 的基本概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%B7%E6%AD%A5-2"><span class="toc-number">1.8.6.2.2.</span> <span class="toc-text">起步</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E6%8C%87%E5%8D%97"><span class="toc-number">1.8.6.2.3.</span> <span class="toc-text">官方指南</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1-Schema-%E5%8F%91%E5%B8%83-Model"><span class="toc-number">1.8.6.2.3.1.</span> <span class="toc-text">设计 Schema 发布 Model</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.6.2.3.2.</span> <span class="toc-text">增加数据</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.6.2.3.3.</span> <span class="toc-text">查询数据</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.6.2.3.4.</span> <span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.6.2.3.5.</span> <span class="toc-text">更新数据</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="toc-number">1.9.</span> <span class="toc-text">异步编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.1.</span> <span class="toc-text">回调函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise"><span class="toc-number">1.9.2.</span> <span class="toc-text">Promise</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.10.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC"><span class="toc-number">1.10.1.</span> <span class="toc-text">代码风格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF"><span class="toc-number">1.10.2.</span> <span class="toc-text">修改代码自动重启</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E8%B7%AF%E5%BE%84%E5%92%8C%E6%A8%A1%E5%9D%97%E8%B7%AF%E5%BE%84"><span class="toc-number">1.10.3.</span> <span class="toc-text">文件操作路径和模块路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-%E6%93%8D%E4%BD%9C-MySql-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.10.4.</span> <span class="toc-text">Node.js 操作 MySql 数据库</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://img2.baidu.com/it/u=2903413025,1209967719&amp;fm=26&amp;fmt=auto')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By AgoniLay</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'fMlK1v2U3cjKJBIaYGEUd6iH-gzGzoHsz',
      appKey: 'k49y92c0BEE6zL2mCA2AUHKu',
      avatar: 'monsterid',
      serverURLs: 'https://fmlk1v2u.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>