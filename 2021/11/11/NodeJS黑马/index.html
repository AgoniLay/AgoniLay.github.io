

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/zoro.jpg">
  <link rel="icon" href="/img/zoro.jpg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#efb9b9">
  <meta name="description" content="">
  <meta name="author" content="AgoniLay">
  <meta name="keywords" content="">
  
  <title>NodeJS 黑马笔记 - AgoniLay的博客</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/vs2015.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/scroller.css">
<link rel="stylesheet" href="/css/bynode.css">
<link rel="stylesheet" href="/css/mouse.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"agonilay.github.io","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":150,"cursorChar":"❤","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading2.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>AgoniLay</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-bookmark"></i>
                索引
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/archives/">
                    <i class="iconfont icon-archive-fill"></i>
                    归档
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/">
                    <i class="iconfont icon-category-fill"></i>
                    分类
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/tags/">
                    <i class="iconfont icon-tags-fill"></i>
                    标签
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/photos/">
                <i class="iconfont icon-image"></i>
                相册
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('http://cdn.agonilay.top/nuc.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h3" id="subtitle" title="NodeJS 黑马笔记">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      AgoniLay
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-11-11 10:34" pubdate>
        2021年11月11日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.4k 字
    </span>
  

  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
			
			
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">NodeJS 黑马笔记</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2021年11月27日 下午
                
              </p>
            
            <div class="markdown-body">
              <h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><h2 id="Node-js-介绍"><a href="#Node-js-介绍" class="headerlink" title="Node.js 介绍"></a>Node.js 介绍</h2><p>node 作者：Ryan Dahl</p>
<h3 id="为什么要学习-Node-js"><a href="#为什么要学习-Node-js" class="headerlink" title="为什么要学习 Node.js"></a>为什么要学习 Node.js</h3><p>企业需求</p>
<ul>
<li>具有服务端开发经验</li>
<li>front-end 前端</li>
<li>back-end 后端</li>
<li>全栈开发工程师<ul>
<li>全干</li>
</ul>
</li>
<li>基本的网站开发能力<ul>
<li>服务端</li>
<li>前端</li>
<li>运维部署</li>
</ul>
</li>
<li>多人社区</li>
</ul>
<h3 id="Node-js-是什么"><a href="#Node-js-是什么" class="headerlink" title="Node.js 是什么"></a>Node.js 是什么</h3><ul>
<li>==Node.js® is a JavaScript runtime built on <a target="_blank" rel="noopener" href="https://v8.dev/">Chrome’s V8 JavaScript engine</a>.==<ul>
<li>Node.js 不是一门语言</li>
<li>Node.js 不是库、不是框架</li>
<li><strong>Node.js 是一个基于 Chorme V8 引擎的 JavaScript 运行时环境</strong></li>
<li>简单来说，Node.js 可以解析和执行 JavaScript 代码</li>
<li>以前只有浏览器可以解析执行 JavaScript 代码</li>
<li>现在的 JavaScript 可以完全脱离浏览器来运行，一切都归功于：Node.js</li>
</ul>
</li>
<li>浏览器中的 JavaScript：<ul>
<li>ECMAScript<ul>
<li>基本的语法：if、var、function、Object、Array…</li>
</ul>
</li>
<li>BOM</li>
<li>DOM</li>
</ul>
</li>
<li>Node.js 中的 JavaScript：<ul>
<li><strong>没有 BOM 、DOM</strong></li>
<li>在 Node.js 执行环境中为 JavaScript 提供了一些服务器级别的操作 API<ul>
<li>文件的读写</li>
<li>网络服务的构建</li>
<li>网络通信</li>
<li>http 服务器 等处理…</li>
</ul>
</li>
</ul>
</li>
<li>构建于 Chrome 的 V8 引擎之上<ul>
<li>代码只是具有特定格式的字符串而已</li>
<li>引擎可以认识它，引擎可以帮你去解释和执行</li>
<li>Google Chorme 的 V8 引擎是目前公认解析执行 JavaScript 代码最快最高效的</li>
<li>Node.js 的作者把 Google Chorme 中的 V8 引擎移植了出来，开发了一个独立的 JavaScript 运行时环境</li>
</ul>
</li>
<li>==Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient.==<ul>
<li>event-driven 事件驱动</li>
<li>non-blocking I/O model 非阻塞 IO 模型（异步）</li>
<li>lightweight and efficient 轻量和高效</li>
</ul>
</li>
<li>==Node.js‘ package ecosystem, npm, is the largest ecosystem of open source libraries in the world.==<ul>
<li>npm 是世界上最大的开源库生态系统</li>
<li>绝大多数 JavaScript 相关的包都存放在了 npm 上，这样做的目的是为了开发人员更方便的去下载使用<br><code>npm install jquery</code></li>
</ul>
</li>
</ul>
<h3 id="Node-js-能做什么"><a href="#Node-js-能做什么" class="headerlink" title="Node.js 能做什么"></a>Node.js 能做什么</h3><ul>
<li>Web 服务器后台</li>
<li>命令行工具<ul>
<li>如：npm(node)、git(c 语言)、hexo(node) …</li>
</ul>
</li>
<li>对于前端开发工程师来将，接触 node 最多的是它的命令行工具<ul>
<li>webpack、gulp、npm…</li>
</ul>
</li>
</ul>
<h3 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h3><ul>
<li>HTML</li>
<li>CSS</li>
<li>JavaScript</li>
<li>简单的命令行操作</li>
<li>具有服务端开发经验更佳</li>
</ul>
<h3 id="一些资源"><a href="#一些资源" class="headerlink" title="一些资源"></a>一些资源</h3><ul>
<li>《深入浅出 Node.js》<ul>
<li>朴灵，偏理论，理解原理底层</li>
</ul>
</li>
<li>《Node.js 权威指南》<ul>
<li>API 讲解</li>
</ul>
</li>
<li>JavaScript 标准参考教程：<a target="_blank" rel="noopener" href="http://javascript.ruanyifeng.com/">http://javascript.ruanyifeng.com</a></li>
<li>Node 入门：<a target="_blank" rel="noopener" href="http://www.nodebeginner.org/index-zh-cn.html">http://www.nodebeginner.org/index-zh-cn.html</a></li>
<li>官方 API 文档：<a target="_blank" rel="noopener" href="https://nodejs.org/dist/latest-v6.x/docs/api">https://nodejs.org/dist/latest-v6.x/docs/api</a></li>
<li>CNode：<a target="_blank" rel="noopener" href="http://cnodejs.org/">http://cnodejs.org</a></li>
</ul>
<h3 id="这门课程你能学到啥？"><a href="#这门课程你能学到啥？" class="headerlink" title="这门课程你能学到啥？"></a>这门课程你能学到啥？</h3><ul>
<li>B/S 编程模型<ul>
<li>Browser - Server</li>
<li>back-end</li>
<li>任何服务器端技术这种 BS 编程模型都是一样，和语言无关</li>
<li>Node 只是作为我们学习 BS 编程模型的一个工具而已</li>
</ul>
</li>
<li>模块化编程<ul>
<li>RequireJS</li>
<li>SeaJS</li>
</ul>
</li>
<li>Node 常用 API</li>
<li>异步编程<ul>
<li>回调函数、Promise、async、generator …</li>
</ul>
</li>
<li>Express Web 开发框架</li>
<li>ECMAScript 6</li>
</ul>
<h2 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h2><h3 id="安装-Node-环境"><a href="#安装-Node-环境" class="headerlink" title="安装 Node 环境"></a>安装 Node 环境</h3><ul>
<li><p>查看当前 Node 环境的版本号</p>
<figure class="highlight crmsh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crmsh"><span class="hljs-keyword">node</span> <span class="hljs-title">--version</span><br><span class="hljs-keyword">node</span> <span class="hljs-title">-v</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>下载：<a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a></p>
</li>
<li><p>安装：</p>
<ul>
<li>傻瓜式的一路 <code>next</code> 就 OK</li>
<li>对于已经安装过的，安装新版会直接覆盖</li>
</ul>
</li>
<li><p>环境变量</p>
</li>
</ul>
<h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><h4 id="解析执行-JavaScript"><a href="#解析执行-JavaScript" class="headerlink" title="解析执行 JavaScript"></a>解析执行 JavaScript</h4><ol>
<li>创建编写 JavaScript 脚本文件</li>
<li>打开终端，定位到脚本文件所属目录</li>
<li>输入 <code>node 文件名</code> 执行对应文件</li>
</ol>
<h4 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h4><p>文件读取：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 浏览器中的 JavaScript 是没有文件操作的能力的</span><br><span class="hljs-comment">// 但是 Node 中的 JavaScript 具有文件操作的能力</span><br><br><span class="hljs-comment">// fs 是 file-system 的简写,就是文件系统的意思</span><br><span class="hljs-comment">// 在 Node 中如果想要进行文件操作，就必须引入 fs 这个核心模块</span><br><span class="hljs-comment">// 在 fs 这个核心模块中，就提供了所有的文件操作相关的 API</span><br><span class="hljs-comment">// 例如：fs.readFile 就是用来读取文件的</span><br><br><span class="hljs-comment">// 1. 使用 require 方法加载 fs 核心模块</span><br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-comment">// 2. 读取文件</span><br><span class="hljs-comment">//    第一个参数就是要读取的文件路径</span><br><span class="hljs-comment">//    第二个参数是一个回调函数</span><br><span class="hljs-comment">//      成功</span><br><span class="hljs-comment">//        data 数据</span><br><span class="hljs-comment">//        error null</span><br><span class="hljs-comment">//      失败</span><br><span class="hljs-comment">//        data undefined 没有数据</span><br><span class="hljs-comment">//        error 错误对象</span><br>fs.readFile(<span class="hljs-string">&quot;./data/hello.txt&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, data</span>) </span>&#123;<br>  <span class="hljs-comment">// &lt;Buffer e9 83 91 e4 bd b3 e4 b8 bd e7 8c aa e5 a4 b4&gt;</span><br>  <span class="hljs-comment">// 文件中存储的其实都是二进制数据 0 1</span><br>  <span class="hljs-comment">// 这里看到的不是 0 和 1 是因为转为了 16 进制</span><br>  <span class="hljs-comment">// 可以使用 toString() 方法转为我们认识的字符</span><br><br>  <span class="hljs-comment">// 在这里就可以通过判断 error 来确认是否有错误发生</span><br>  <span class="hljs-keyword">if</span> (error) &#123;<br>    <span class="hljs-comment">// console.log(error)</span><br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;读取文件失败了&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-built_in">console</span>.log(data.toString());<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>文件写入：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-comment">// 第一个参数：文件路径</span><br><span class="hljs-comment">// 第二个参数：文件内容</span><br><span class="hljs-comment">// 第三个参数：回调函数</span><br><span class="hljs-comment">//    文件写入成功： error 是 null</span><br><span class="hljs-comment">//    文件写入失败： error 就是错误对象</span><br>fs.writeFile(<br>  <span class="hljs-string">&quot;./data/hello.md&quot;</span>,<br>  <span class="hljs-string">&quot;Hello everyone, I am AgoniLay.&quot;</span>,<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;写入失败&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;写入成功&quot;</span>);<br>    &#125;<br>  &#125;<br>);<br></code></pre></div></td></tr></table></figure>

<h4 id="http"><a href="#http" class="headerlink" title="http"></a>http</h4><p>最简单的 http 服务：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 1. 加载 http 核心模块</span><br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><br><span class="hljs-comment">// 2. 使用 http.createServer() 方法创建一个 Web 服务器</span><br><span class="hljs-keyword">var</span> server = http.createServer();<br><br><span class="hljs-comment">// 3. 注册 request 请求事件</span><br>server.on(<span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;收到客户端的请求了&quot;</span>);<br>&#125;);<br><br><span class="hljs-comment">// 4. 绑定端口号，启动服务器</span><br>server.listen(<span class="hljs-number">3000</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;服务器启动成功了，可以通过 http://127.0.0.1:3000/ 来访问&quot;</span>);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<img src="/2021/11/11/NodeJS%E9%BB%91%E9%A9%AC/image-20211021173440069.png" srcset="/img/loading2.gif" lazyload class title="image-20211021173440069">

<h2 id="Node-中的-JavaScript"><a href="#Node-中的-JavaScript" class="headerlink" title="Node 中的 JavaScript"></a>Node 中的 JavaScript</h2><h3 id="ECMAScript"><a href="#ECMAScript" class="headerlink" title="ECMAScript"></a>ECMAScript</h3><ul>
<li>没有 DOM、BOM</li>
</ul>
<h3 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h3><p>核心模块是由 Node 提供的一个个的具名的模块。它们都有自己特殊的名称表示。</p>
<p>Node 为 JavaScript 提供了很多服务器级别的 API，这些 API 绝大多数都被包装到了一个具名的核心模块中了，例如：</p>
<ul>
<li>fs：文件操作模块</li>
<li>http：网络服务构建模块</li>
<li>os：操作系统信息模块</li>
<li>path：路径处理模块</li>
<li>url：url 地址模块</li>
</ul>
<p>若要使用则需要：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br></code></pre></div></td></tr></table></figure>

<h3 id="模块系统"><a href="#模块系统" class="headerlink" title="模块系统"></a>模块系统</h3><p>在 Node 中没有全局作用域的概念，而是模块作用域。</p>
<p>在 Node 中，只能通过 require 方法来加载执行多个 JavaScript 脚本文件</p>
<p>require 加载只能是执行其中的代码，文件与文件之间由于是模块作用域，所以不会有污染的问题</p>
<ul>
<li>外部访问不到内部</li>
<li>内部也访问不到外部</li>
<li>默认都是封闭的</li>
</ul>
<p>require 方法有两个作用：</p>
<ol>
<li>加载文件模块，并执行里面的代码</li>
<li>拿到被加载文件模块导出的接口对象</li>
</ol>
<p>每个文件模块中都提供了一个对象 exports，exports 默认是一个空对象，需要做的是将所有需要被外部访问的成员</p>
<h2 id="Web-服务器开发"><a href="#Web-服务器开发" class="headerlink" title="Web 服务器开发"></a>Web 服务器开发</h2><h3 id="ip-地址和端口号"><a href="#ip-地址和端口号" class="headerlink" title="ip 地址和端口号"></a>ip 地址和端口号</h3><ul>
<li>IP 地址用来定位计算机</li>
<li>端口号用来定位具体的应用程序</li>
<li>所有需要联网通信的应用程序都会占用一个端口号</li>
<li>端口号的范围从 0 - 65536 之间</li>
<li>在计算机中有一些默认端口号，最好不要去使用<ul>
<li>例如 http 服务的 80</li>
</ul>
</li>
<li>可以同时给 hi 开启多个服务，但一定要确保不同服务占用的端口号不一致才可以</li>
</ul>
<h3 id="Content-Type"><a href="#Content-Type" class="headerlink" title="Content-Type"></a>Content-Type</h3><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">resquest.setHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span>);<br></code></pre></div></td></tr></table></figure>

<ul>
<li>不同的资源对应的 Content-Type 是不一样的，具体参照：<a target="_blank" rel="noopener" href="https://tool.oschina.net/commons">https://tool.oschina.net/commons</a></li>
<li>图片不需要指定编码（charset）</li>
<li>一般为字符数据才指定编码</li>
</ul>
<h4 id="客户端渲染和客户端渲染"><a href="#客户端渲染和客户端渲染" class="headerlink" title="客户端渲染和客户端渲染"></a>客户端渲染和客户端渲染</h4><ul>
<li>客户端渲染不利于 SEO 搜索引擎优化</li>
<li>服务端渲染可以被爬虫抓取到的，客户端异步渲染是很难被爬虫抓取到的</li>
</ul>
<h3 id="301-和-302-重定向"><a href="#301-和-302-重定向" class="headerlink" title="301 和 302 重定向"></a>301 和 302 重定向</h3><p>3xx 开头的状态码为重定向</p>
<ul>
<li>301 永久重定向，浏览器会记住</li>
<li>302 临时重定向</li>
</ul>
<h2 id="Node-中的模块系统"><a href="#Node-中的模块系统" class="headerlink" title="Node 中的模块系统"></a>Node 中的模块系统</h2><h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><h3 id="CommonJS-模块规范"><a href="#CommonJS-模块规范" class="headerlink" title="CommonJS 模块规范"></a>CommonJS 模块规范</h3><p>加载 require</p>
<p>导出 exports</p>
<h4 id="原理解析"><a href="#原理解析" class="headerlink" title="原理解析"></a>原理解析</h4><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 在 Node 中，每个模块内部都有一个自己的 module 对象</span><br><span class="hljs-comment">// 该 module 对象中，有一个成员叫 exports 也是一个对象</span><br><br><span class="hljs-comment">// var module = &#123;</span><br><span class="hljs-comment">//   exports: &#123;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//   &#125;</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-comment">// 在模块中还有这么一句代码</span><br><span class="hljs-comment">// exports 和 module.exports 指向同一个引用</span><br><span class="hljs-comment">// var exports = module.exports</span><br><br><span class="hljs-comment">// 两者一致，那就说明，可以使用任意一方来导出</span><br><span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">exports</span> === <span class="hljs-built_in">module</span>.exports); <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// 直接给 exports 赋值不管用</span><br><span class="hljs-built_in">exports</span> = <span class="hljs-string">&quot;hello&quot;</span>;<br><span class="hljs-comment">// 最后 return 的是 module.export</span><br><br><span class="hljs-comment">// 默认在代码的最后有一句</span><br><span class="hljs-comment">// return module.exports</span><br></code></pre></div></td></tr></table></figure>

<blockquote>
<p>要注意 exports 和 modules.export 的区别</p>
</blockquote>
<h4 id="require-加载规则"><a href="#require-加载规则" class="headerlink" title="require 加载规则"></a>require 加载规则</h4><blockquote>
<p>参考书籍资料：《深入浅出 Node.js》深入 Node.js 的模块机制</p>
</blockquote>
<ul>
<li>优先从缓存加载</li>
<li>判断模块标识<ul>
<li>核心模块</li>
<li>第三方模块</li>
<li>自己写的模块</li>
</ul>
</li>
</ul>
<p>路径形式的模块</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 路径形式的模块:</span><br><span class="hljs-comment">//  ./</span><br><span class="hljs-comment">//  ../</span><br><span class="hljs-comment">//  /xxx</span><br><span class="hljs-comment">//  首位的 / 在这里表示的是当前文件模块所属磁盘根路径\</span><br><span class="hljs-comment">//  .js 后缀名可以省略,但 ./ 不能省略</span><br><span class="hljs-comment">// require(&#x27;./foo.js&#x27;)</span><br></code></pre></div></td></tr></table></figure>

<p>非路径形式的模块标识</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 核心模块的本质也是文件</span><br><span class="hljs-comment">// 核心模块文件已经被编译到二进制文件中了</span><br><span class="hljs-comment">// require(&#x27;fs&#x27;)</span><br><span class="hljs-comment">// require(&#x27;http&#x27;)</span><br><br><span class="hljs-comment">// 第三方模块</span><br><span class="hljs-comment">// 凡是第三方模块都必须通过 npm 来瞎子</span><br><span class="hljs-comment">// 使用的是由就可以通过 require(&#x27;包名) 的方式来进行加载才可以使用</span><br><span class="hljs-comment">// 既不是核心模块也不是路径形式的模块</span><br><span class="hljs-comment">//    先找到当前文件所处目录的 node_modules 目录</span><br><span class="hljs-comment">//    然后找 相对应的包名</span><br><span class="hljs-comment">//    再找 该包下的 package.json 文件</span><br><span class="hljs-comment">//    再文件里面找 main 属性:记录了 该模块的入口</span><br><br><span class="hljs-comment">//    如果 package.json 文件不存在或者 main 指定的文件入口模块没有，</span><br><span class="hljs-comment">//    则 node 会自动寻找 模块中的 index.js // 作为默认备选项</span><br><br><span class="hljs-comment">//    如果以上所有任何一个条件不成立，则会进入上一级目录中的 node_modules 目录查找，规则照旧，依次反复</span><br><span class="hljs-comment">//    直到当前磁盘根目录还找不到，最后报错：</span><br><span class="hljs-comment">//      Error: Cannot find module &#x27;xxx&#x27;</span><br></code></pre></div></td></tr></table></figure>

<h3 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h3><p>npm（node package manager），node 的包管理器</p>
<p>官方网址：<a target="_blank" rel="noopener" href="http://www.npmjs.com/">http://www.npmjs.com</a></p>
<p>npm 就是一个命令行工具，安装了 node 就已经安装了 npm</p>
<p>可以再命令行查看版本：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm --version<br></code></pre></div></td></tr></table></figure>

<p>升级 npm（自己升级自己）：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install --global npm<br></code></pre></div></td></tr></table></figure>

<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p>npm init</p>
<ul>
<li><code>npm init -y</code> 可以跳过向导，快速生成</li>
</ul>
<p>npm install</p>
<ul>
<li><code>npm install</code>：一次性把 dependencies 选项中的依赖项全部安装</li>
<li><code>npm install 包名</code>：只下载</li>
<li><code>npm install --save 包名</code>：下载并且保存依赖项<ul>
<li>保存到 package.json 文件中的 dependencies 选项</li>
<li>简写：<code>npm i -S 包名</code></li>
</ul>
</li>
<li><code>npm uninstall 包名</code>：只删除，有依赖项依然会保存<ul>
<li>简写：<code>npm un 包名</code></li>
</ul>
</li>
<li><code>npm uninstall --save 包名</code>：删除同时将依赖信息也去除<ul>
<li>简写：<code>npm un -S 包名</code></li>
</ul>
</li>
<li><code>npm --help</code> &amp;&amp; <code>npm help</code>：查看使用帮助<ul>
<li><code>npm 命令 --help</code>：查看具体命令的使用帮助</li>
</ul>
</li>
</ul>
<h4 id="解决-npm-被墙问题"><a href="#解决-npm-被墙问题" class="headerlink" title="解决 npm 被墙问题"></a>解决 npm 被墙问题</h4><p>npm 存储包文件的服务器在国外，有时候会被墙，速度很慢。</p>
<p><a target="_blank" rel="noopener" href="http://npm.taobao.org/">http://npm.taobao.org</a> 淘宝的开发团队把 npm 在国内做了一个备份。</p>
<p>安装淘宝的 cnpm：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 在任意目录执行都可以</span><br><span class="hljs-meta">#</span><span class="bash"> --global 表示安装到全局，而非当前目录</span><br>npm install --global cnpm<br></code></pre></div></td></tr></table></figure>

<p>接下来你安装包的时候把之前的 <code>npm</code> 替换成 <code>cnpm</code>。</p>
<p>如果不想安装 cnpm 又想使用淘宝的服务器来下载：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install jquery --registry=https://registry.npm.taobao.org<br></code></pre></div></td></tr></table></figure>

<p>但上面命令需要每一次手动添加参数很麻烦，所以可以把这个选项加入配置文件中：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm config set registry https://registry.npm.taobao.org<br></code></pre></div></td></tr></table></figure>

<p>只要经过了上面命令的配置，则以后所有的 <code>npm install </code> 都会默认通过淘宝的服务器来下载。</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看 npm 配置信息</span><br>npm config list<br></code></pre></div></td></tr></table></figure>

<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>建议每一个项目都要有一个 <code>package.json</code> 文件（包描述文件）。</p>
<p>可以自动初始化：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm init<br></code></pre></div></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">❯ npm init<br>This utility will walk you through creating a package.json file.<br>It only covers the most common items, and tries to guess sensible defaults.<br><br>See `npm help init` for definitive documentation on these fields<br>and exactly what they do.<br><br>Use `npm install &lt;pkg&gt;` afterwards to install a package and<br>save it as a dependency in the package.json file.<br><br>Press ^C at any time to quit.<br>package name: (npm-demo)<br>version: (1.0.0) 0.0.1<br>description: 这是一个测试项目<br>entry point: (index.js) main.js<br>test command:<br>git repository:<br>keywords:<br>author: AgoniLay<br>license: (ISC)<br>About to write to F:\课堂笔记\web-pink\nodejs\nodejs黑马\03\code\npm-demo\package.json:<br><br>&#123;<br>  &quot;name&quot;: &quot;npm-demo&quot;,<br>  &quot;version&quot;: &quot;0.0.1&quot;,<br>  &quot;description&quot;: &quot;这是一个测试项目&quot;,<br>  &quot;main&quot;: &quot;main.js&quot;,<br>    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;<br>  &#125;,<br>  &quot;author&quot;: &quot;AgoniLay&quot;,<br>  &quot;license&quot;: &quot;ISC&quot;<br>&#125;<br><br><br>Is this OK? (yes) yes<br>❯ npm i jquery --save<br>npm notice created a lockfile as package-lock.json. You should commit this file.<br>npm WARN npm-demo@0.0.1 No repository field.<br><br>+ jquery@3.6.0<br>added 1 package from 1 contributor in 0.414s<br>❯<br></code></pre></div></td></tr></table></figure>

<p>目前最有用的是 <code>dependencies</code> 选项，可以用来帮我们保存第三方包的依赖信息。</p>
<ul>
<li>建议每个项目的根目录下都有一个 package.json 文件</li>
<li>建议执行 <code>npm install 包名 </code> 的时候都加上 <code>--save</code> 这个选项，目的是用来保存依赖项信息</li>
</ul>
<p>如果 <code>node_modules</code> 删除或丢失了也不用担心，只需要 <code>npm install</code> 就会自动把 <code>package.json</code> 中的 <code>dependencies</code> 中所有的依赖项 iang 都下载回来。</p>
<h3 id="package-json-和-package-lock-json"><a href="#package-json-和-package-lock-json" class="headerlink" title="package.json 和 package-lock.json"></a>package.json 和 package-lock.json</h3><p>npm 5 以前是不会有 <code>package-lock.json</code> 这个文件的，npm 5 以后才添加的。</p>
<p>当安装包时，npm 都会生成或者更新 <code>package-lock.json</code></p>
<ul>
<li>npm 5 以后的版本安装包时，不需要加 <code>--save</code> 参数，它会自动保存依赖信息；</li>
<li>当你安装包时，会自动生成 <code>package-lock.json</code> 这个文件<ul>
<li>这个文件会保存 <code>node_modules</code> 中所有包的信息（版本，下载地址），起到使 <code>npm install</code> 时<strong>速度提升</strong>的作用；</li>
<li>从文件来看，有一个 <code>lock</code>，这个 lock 是用来锁定版本的</li>
<li>如果项目依赖了 <code>1.1.1</code> 版本，如果重新 install 其实会下载最新版本，所以这个文件的另一个作用就是<strong>锁定版本号</strong>，防止自动升级新版</li>
</ul>
</li>
</ul>
<h3 id="path-路径操作模块"><a href="#path-路径操作模块" class="headerlink" title="path 路径操作模块"></a>path 路径操作模块</h3><blockquote>
<p>参考文档：<a target="_blank" rel="noopener" href="http://nodejs.cn/api/path.html">http://nodejs.cn/api/path.html</a></p>
</blockquote>
<ul>
<li>path.basename：获取文件名（默认包含后缀名）</li>
<li>path.dirname：获取目录部分</li>
<li>path.extname：获取扩展名部分</li>
<li>path.parse：把一个路径转为对象<ul>
<li>root：根路径</li>
<li>dir：目录</li>
<li>base：包含后缀名的文件名</li>
<li>ext：后缀名</li>
<li>name：不包含后缀名的文件名</li>
</ul>
</li>
<li>path.join：路径拼接</li>
<li>path.isAbsolute：判断一个路径是否是绝对路径</li>
</ul>
<h3 id="Node-中的其他成员"><a href="#Node-中的其他成员" class="headerlink" title="Node 中的其他成员"></a>Node 中的其他成员</h3><p>在每个模块中，除了 <code>require</code>、<code>exports</code> 等模块相关 API 之外，还有两个特殊的成员：</p>
<ul>
<li><code>__dirname</code>：<strong>动态获取</strong> 可以用来获取当前文件模块所属目录的绝对路径</li>
<li><code>__filename</code>：<strong>动态获取</strong> 可以用来获取当前文件的绝对路径</li>
<li><code>__dirname</code> 和 <code>__filename</code> 是不受执行 node 命令所属路径影响的</li>
</ul>
<p>在文件操作中，使用相对路径是不可靠的，因为在 Node 中文件操作的路径被设计为相对于执行 node 命令所处的路径（不是 bug，这样设计有使用背景）。</p>
<p>解决办法就是换为绝对路径使用 <code>__dirname</code> 和 <code>__filename</code> 即可。</p>
<p>在拼接路径的过程中，为了避免手动拼接带来的一些低级错误，所以推荐多使用：<code>path.join()</code> 来辅助拼接。</p>
<p>所以为了尽量避免刚才所描述的这个问题，大家以后再文件操作中使用的相对路径都统一转换为 <strong>动态的绝对路径</strong>。</p>
<blockquote>
<p>补充：模块中的路径表示和这里的路径没关系，不受影响（相对于文件模块）</p>
</blockquote>
<h2 id="Node-目录结构"><a href="#Node-目录结构" class="headerlink" title="Node 目录结构"></a>Node 目录结构</h2><figure class="highlight 1c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs 1c">.<br><span class="hljs-string">|--app.js							项目入口文件</span><br><span class="hljs-string">|--controllers</span><br><span class="hljs-string">|--models							存储使用 mongoose 设计的数据模型</span><br><span class="hljs-string">|--node_modules				第三方依赖包文件夹</span><br><span class="hljs-string">|--package.json				包描述文件</span><br><span class="hljs-string">|--package-lock.json	第三方包版本锁定文件（npm 5 以后才有）</span><br><span class="hljs-string">|--public							公共的静态资源</span><br><span class="hljs-string">|--README.md					项目说明文档</span><br><span class="hljs-string">|--routes							路由分类文件夹</span><br><span class="hljs-string">|--views							存储视图目录</span><br><span class="hljs-string">|--.gitignore</span><br></code></pre></div></td></tr></table></figure>

<h2 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h2><p>原生的 http 在某些方面表现不足以应对我们的开发需求，所以需要使用框架来加快我们的开发效率，框架的目的就是提高效率，让我们的代码高度统一。</p>
<p>express，作者：TJ，目前已到社区维护（<a target="_blank" rel="noopener" href="https://www.expressjs.com.cn/%EF%BC%89">https://www.expressjs.com.cn/）</a></p>
<h3 id="起步-1"><a href="#起步-1" class="headerlink" title="起步"></a>起步</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install --save express<br></code></pre></div></td></tr></table></figure>

<h4 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h4><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> app = express();<br><br>app.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.send(<span class="hljs-string">&quot;hello world&quot;</span>);<br>&#125;);<br><br>app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;app is running...&quot;</span>);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<h4 id="基本路由"><a href="#基本路由" class="headerlink" title="基本路由"></a>基本路由</h4><p>路由器：</p>
<ul>
<li>请求方法</li>
<li>请求路径</li>
<li>请求处理函数</li>
</ul>
<p>get：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 当你以 GET 方法请求 / 的时候，执行对应的处理函数</span><br>app.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  res.send(<span class="hljs-string">&quot;hello world&quot;</span>);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>post：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 当你以 POST 方法请求 / 的时候，执行对应的处理函数</span><br>app.post(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  res.send(<span class="hljs-string">&quot;Got a POST request&quot;</span>);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<h4 id="静态服务"><a href="#静态服务" class="headerlink" title="静态服务"></a>静态服务</h4><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 当以 /public/ 开头的时候，去 ./public/ 目录中找对应的资源</span><br>app.use(<span class="hljs-string">&quot;/public/&quot;</span>, express.static(<span class="hljs-string">&quot;./public/&quot;</span>));<br><br><span class="hljs-comment">// 相当于给 public 起了一个别名，但不建议</span><br>app.use(<span class="hljs-string">&quot;/a/&quot;</span>, express.static(<span class="hljs-string">&quot;./public/&quot;</span>));<br><br><span class="hljs-comment">// 当省略第一个参数的时候，通过 省略 /public 的方式来访问</span><br>app.use(express.static(<span class="hljs-string">&quot;./public/&quot;</span>));<br></code></pre></div></td></tr></table></figure>

<h3 id="在-Express-配置使用-art-template-模版引擎"><a href="#在-Express-配置使用-art-template-模版引擎" class="headerlink" title="在 Express 配置使用 art-template 模版引擎"></a>在 Express 配置使用 art-template 模版引擎</h3><p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install --save art-template<br>npm install --save express-art-template<br></code></pre></div></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">app.engine(<span class="hljs-string">&quot;html&quot;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express-art-template&quot;</span>));<br></code></pre></div></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">app.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  <span class="hljs-comment">// express 默认会去项目中的 views 目录找 index.html</span><br>  res.render(<span class="hljs-string">&quot;index.html&quot;</span>, &#123;<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;hello world&quot;</span>,<br>  &#125;);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>如果希望修改默认的 views 视图渲染存储目录，可以：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 注意：一个参数 views 是固定的，不要写错</span><br>app.set(<span class="hljs-string">&quot;views&quot;</span>, <span class="hljs-string">&quot;目录路径&quot;</span>);<br></code></pre></div></td></tr></table></figure>

<h3 id="Express-获取表单-POST-请求参数"><a href="#Express-获取表单-POST-请求参数" class="headerlink" title="Express 获取表单 POST 请求参数"></a>Express 获取表单 POST 请求参数</h3><p>Express 内置了一个 API，可以直接通过 <code>req.query</code> 来获取</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">req.query;<br></code></pre></div></td></tr></table></figure>

<h3 id="Express-获取表单-POST-请求体数据"><a href="#Express-获取表单-POST-请求体数据" class="headerlink" title="Express 获取表单 POST 请求体数据"></a>Express 获取表单 POST 请求体数据</h3><p>在 express 中没有内置获取表单 POST 请求体的 API，这里是我们需要使用一个第三方包：<code>body-parser</code></p>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install --save body-parser<br></code></pre></div></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-comment">// 0. 引包</span><br><span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;body-parser&quot;</span>);<br><br><span class="hljs-keyword">var</span> app = express();<br><br><span class="hljs-comment">// 配置 body-parser</span><br><span class="hljs-comment">// 只要加入这个配置，则在 req 请求对象上会多出来一个属性：body</span><br>app.use(bodyParser.urlencoded(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;));<br>app.use(bodyParser.json());<br></code></pre></div></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">app.use(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  res.setHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;text/plain&quot;</span>);<br>  res.write(<span class="hljs-string">&quot;you posted:\n&quot;</span>);<br>  res.end(<span class="hljs-built_in">JSON</span>.stringify(req.body, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<h3 id="Express-配置使用-express-session-插件"><a href="#Express-配置使用-express-session-插件" class="headerlink" title="Express 配置使用 express-session 插件"></a>Express 配置使用 express-session 插件</h3><blockquote>
<p>参考文档：<a target="_blank" rel="noopener" href="https://www.expressjs.com.cn/en/resources/middleware/session.html">https://www.expressjs.com.cn/en/resources/middleware/session.html</a></p>
</blockquote>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install express-session<br></code></pre></div></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 该插件会为 req 请求对象添加一个成员：req.session 默认是一个对象</span><br>app.use(<br>  session(&#123;<br>    <span class="hljs-comment">// 配置加密字符串，它会在原有加密基础之上和这个字符串拼起来去加密</span><br>    <span class="hljs-comment">// 目的是为了增加安全性，防止客户端恶意伪造</span><br>    <span class="hljs-attr">secret</span>: <span class="hljs-string">&quot;AgoniLay&quot;</span>,<br>    <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 无论你是否使用 Session ，我都默认直接给你分配一把钥匙</span><br>  &#125;)<br>);<br></code></pre></div></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 添加 Session 数据</span><br>req.session.foo = <span class="hljs-string">&quot;AgoniLay&quot;</span>;<br><br><span class="hljs-comment">// 获取 Session 数据</span><br>req.session.foo;<br><br><span class="hljs-comment">// 删除 Session 数据</span><br>req.session.foo = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 不严谨</span><br><span class="hljs-keyword">delete</span> req.session.foo;<br></code></pre></div></td></tr></table></figure>

<p>提示：默认 session 数据是内存存储的，服务器一旦重启就会丢失，真正的生产环境会把 Session 进行持久化存储</p>
<h3 id="CRUD-案例"><a href="#CRUD-案例" class="headerlink" title="CRUD 案例"></a>CRUD 案例</h3><h4 id="路由设计"><a href="#路由设计" class="headerlink" title="路由设计"></a>路由设计</h4><table>
<thead>
<tr>
<th>请求方法</th>
<th>请求路径</th>
<th>get 参数</th>
<th>post 参数</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>/students</td>
<td></td>
<td></td>
<td>渲染首页</td>
</tr>
<tr>
<td>GET</td>
<td>/students/new</td>
<td></td>
<td></td>
<td>渲染添加学生界面</td>
</tr>
<tr>
<td>POST</td>
<td>/students/new</td>
<td></td>
<td>name,age,gender,hobbies</td>
<td>处理添加学生请求</td>
</tr>
<tr>
<td>GET</td>
<td>/students/edit</td>
<td>id</td>
<td></td>
<td>渲染编辑页面</td>
</tr>
<tr>
<td>POST</td>
<td>/students/edit</td>
<td></td>
<td>id,name,age,gender,hobbies</td>
<td>处理编辑请求</td>
</tr>
<tr>
<td>GET</td>
<td>/students/delete</td>
<td>id</td>
<td></td>
<td>处理删除请求</td>
</tr>
</tbody></table>
<h4 id="自己编写的步骤"><a href="#自己编写的步骤" class="headerlink" title="自己编写的步骤"></a>自己编写的步骤</h4><ol>
<li>处理模板</li>
<li>配置开放静态资源</li>
<li>配置模板引擎</li>
<li>简单路由：/student 渲染静态页出来</li>
<li>路由设计</li>
<li>提取路由模块</li>
<li>由于接下来一系列的业务操作都需要处理文件数据，所以需要封装异步方法</li>
</ol>
<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>中间件的本质就是一个请求处理方法，我们把用户从请求到响应的整个过程分发到多个中间件中去处理，这样做的目的是提高代码的灵活性，动态可扩展性。</p>
<h4 id="应用程序级别中间件"><a href="#应用程序级别中间件" class="headerlink" title="应用程序级别中间件"></a>应用程序级别中间件</h4><p>万能匹配：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">app.use(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Time: &quot;</span>, <span class="hljs-built_in">Date</span>.now());<br>  next();<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>只要是以 <code>/xxx/</code> 开头的：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">app.use(<span class="hljs-string">&quot;/a&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Time: &quot;</span>, <span class="hljs-built_in">Date</span>.now());<br>  next();<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<h4 id="路由级别中间件"><a href="#路由级别中间件" class="headerlink" title="路由级别中间件"></a>路由级别中间件</h4><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">app.get(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  res.send(<span class="hljs-string">&quot;Hello World!&quot;</span>);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><h3 id="关系型数据库和非关系型数据库"><a href="#关系型数据库和非关系型数据库" class="headerlink" title="关系型数据库和非关系型数据库"></a>关系型数据库和非关系型数据库</h3><p>表就是关系</p>
<ul>
<li>所有的关系型数控都需要通过 <code>sql</code> 语言来操作</li>
<li>所有的关系型数据库在操作之前都需要设计表结构</li>
<li>而且数据表还支持约束</li>
</ul>
<p>非关系型数据库非常的灵活</p>
<ul>
<li>有的非关系型数据库就是 key-value 对儿</li>
<li>但是 MongoDB 是长的最像关系型数据库的非关系型数据库</li>
<li>MongoDB 不需要设计表结构，可以任意的往里面存数据</li>
</ul>
<h3 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h3><p>官方下载地址： <a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download">https://www.mongodb.com/try/download</a></p>
<p>需要配置环境变量 bin 目录路径</p>
<p>输入 <code>mongod --version</code> 测试是否安装成功</p>
<h3 id="启动和关闭数据库"><a href="#启动和关闭数据库" class="headerlink" title="启动和关闭数据库"></a>启动和关闭数据库</h3><p>启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> mongodb 默认使用执行 mongd 命令所处盘符根目录下的 /data/db 做为自己的数据存储目录</span><br><span class="hljs-meta">#</span><span class="bash"> 所以在第一次执行该命令之前先手动创建一个 /data/db</span><br>mongod<br></code></pre></div></td></tr></table></figure>

<p>如果想要修改默认的数据存储目录，可以：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">mongo --dbpath=数据存储目录路径<br></code></pre></div></td></tr></table></figure>

<p>停止：</p>
<ol>
<li>在开启服务的控制台直接 ctrl + c 停止</li>
<li>关闭命令行窗口停止</li>
</ol>
<h3 id="连接和退出数据库"><a href="#连接和退出数据库" class="headerlink" title="连接和退出数据库"></a>连接和退出数据库</h3><p>连接：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 该命令默认连接本机的 MongoDB 服务</span><br>mongo<br></code></pre></div></td></tr></table></figure>

<p>退出：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 在连接状态输入</span><br>exit<br></code></pre></div></td></tr></table></figure>

<h3 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h3><ul>
<li><code>show dbs</code>：查看显示所有数据库<ul>
<li><code>db</code>：查看当前连接的数据库</li>
</ul>
</li>
<li><code>use 数据库名称</code>：切换到指定的数据库（如果没有会新建）</li>
<li>插入数据：<code>db.students.insertOne(&#123;&quot;name&quot;, &quot;AgoniLay&quot;&#125;)</code></li>
<li>查看所有集合：<code>db collections</code></li>
<li>查看某集合中所有数据：<code>db.students.find()</code></li>
</ul>
<h3 id="在-Node-中如何操作-MongoDB-数据"><a href="#在-Node-中如何操作-MongoDB-数据" class="headerlink" title="在 Node 中如何操作 MongoDB 数据"></a>在 Node 中如何操作 MongoDB 数据</h3><h4 id="使用官方的-mongodb-包来操作"><a href="#使用官方的-mongodb-包来操作" class="headerlink" title="使用官方的 mongodb 包来操作"></a>使用官方的 mongodb 包来操作</h4><p>github 地址：<a target="_blank" rel="noopener" href="https://github.com/mongodb/node-mongodb-native">https://github.com/mongodb/node-mongodb-native</a></p>
<h4 id="使用第三方-mongoose-来操作-MongDB-数据库"><a href="#使用第三方-mongoose-来操作-MongDB-数据库" class="headerlink" title="使用第三方 mongoose 来操作 MongDB 数据库"></a>使用第三方 mongoose 来操作 MongDB 数据库</h4><p>第三方包：<code>mongoose</code> 基于 MongoDB 官方的 <code>mongodb</code> 包再一次做了封装</p>
<p>官网：<a target="_blank" rel="noopener" href="https://mongoosejs.com/">https://mongoosejs.com/</a></p>
<h5 id="MongoDB-的基本概念"><a href="#MongoDB-的基本概念" class="headerlink" title="MongoDB 的基本概念"></a>MongoDB 的基本概念</h5><ul>
<li>数据库</li>
<li>一个数据库中可以有多个集合（表）</li>
<li>一个集合中可以有多个文档（表记录）</li>
<li>文档结构很灵活，没有任何限制</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  qq: &#123;<br>    users: [<br>      &#123; name: &#x27;AgoniLay&#x27;, age: <span class="hljs-number">15</span> &#125;, &#123;&#125;...<br>    ],<br>    products: []<br>  &#125;,<br>  taobao: &#123;&#125;,<br>  baidu: &#123;&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h5 id="起步-2"><a href="#起步-2" class="headerlink" title="起步"></a>起步</h5><p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm i mongoose<br></code></pre></div></td></tr></table></figure>

<p>小案例：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mongoose&quot;</span>);<br><br><span class="hljs-comment">// 连接 MongoDB 数据库</span><br>mongoose.connect(<span class="hljs-string">&quot;mongodb://localhost/test&quot;</span>);<br><br><span class="hljs-comment">// 创建一个模型</span><br><span class="hljs-comment">// 就是在设计数据库</span><br><span class="hljs-comment">// MongoDB 是动态的，非常灵活，只需要在代码中设计你的数据库就可以了</span><br><span class="hljs-keyword">const</span> Cat = mongoose.model(<span class="hljs-string">&quot;Cat&quot;</span>, &#123; <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span> &#125;);<br><br><span class="hljs-comment">// 实例化一个 Cat</span><br><span class="hljs-keyword">const</span> kitty = <span class="hljs-keyword">new</span> Cat(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;AgoniLay&quot;</span> &#125;);<br><br><span class="hljs-comment">// 持久化保存 kitty 实例</span><br>kitty.save(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-built_in">console</span>.log(err);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;meow&quot;</span>);<br>  &#125;<br>&#125;);<br><span class="hljs-comment">// .then(() =&gt; console.log(&#x27;meow&#x27;))</span><br></code></pre></div></td></tr></table></figure>

<h5 id="官方指南"><a href="#官方指南" class="headerlink" title="官方指南"></a>官方指南</h5><h6 id="设计-Schema-发布-Model"><a href="#设计-Schema-发布-Model" class="headerlink" title="设计 Schema 发布 Model"></a>设计 Schema 发布 Model</h6><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mongoose&quot;</span>);<br><br><span class="hljs-keyword">var</span> Schema = mongoose.Schema;<br><br><span class="hljs-comment">// 1. 连接数据库</span><br><span class="hljs-comment">// 指定连接的数据库不需要存在，当你插入第一条数据之后就会自动被创建出来</span><br>mongoose.connect(<span class="hljs-string">&quot;mongodb://localhost/itcast&quot;</span>);<br><br><span class="hljs-comment">// 2. 设计集合结构（表结构）</span><br><span class="hljs-comment">// 字段名称就是表结构中的属性名称</span><br><span class="hljs-comment">// 约束的目的是为了保证数据的完整性，不要有脏数据</span><br><span class="hljs-keyword">var</span> userSchema = <span class="hljs-keyword">new</span> Schema(&#123;<br>  <span class="hljs-attr">username</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,<br>    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 必须有</span><br>  &#125;,<br>  <span class="hljs-attr">password</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,<br>    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  <span class="hljs-attr">email</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,<br>  &#125;,<br>&#125;);<br><br><span class="hljs-comment">// 3. 将文档结构发布为模型</span><br><span class="hljs-comment">//    mongoose.model 方法就是用来将一个架构发布为 model</span><br><span class="hljs-comment">//    第一个参数：传入一个大写单词字符串用来表示你的数据库名称</span><br><span class="hljs-comment">//               mongoose 会自动将大写名词的字符串生成 小写复数 的集合名称</span><br><span class="hljs-comment">//               例如这里的 User 最终会变为 users 集合名称</span><br><span class="hljs-comment">//    第二个参数：架构 Schema</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    返回值：模型构造函数</span><br><span class="hljs-keyword">var</span> User = mongoose.model(<span class="hljs-string">&quot;user&quot;</span>, userSchema);<br><br><span class="hljs-comment">// 4. 当我们有了模型的构造函数之后，就可以使用这个构造函数对 users 集合中的数据为所欲为了（增删改查）</span><br></code></pre></div></td></tr></table></figure>

<h6 id="增加数据"><a href="#增加数据" class="headerlink" title="增加数据"></a>增加数据</h6><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> User(&#123;<br>  <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>  <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;123456&quot;</span>,<br>  <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;admin@admin.com&quot;</span>,<br>&#125;);<br><br>user.save(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;保存失败&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;保存成功&quot;</span>);<br>    <span class="hljs-built_in">console</span>.log(data);<br>  &#125;<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<h6 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h6><p>查询所有：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">User.find(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;查询失败&quot;</span>);<br>  <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;查询成功&quot;</span>);<br>    <span class="hljs-built_in">console</span>.log(data);<br>  &#125;<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>按条件查询所有：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">User.find(<br>  &#123;<br>    <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;AgoniLay&quot;</span>,<br>  &#125;,<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;查询失败&quot;</span>);<br>    <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;查询成功&quot;</span>);<br>      <span class="hljs-built_in">console</span>.log(data);<br>    &#125;<br>  &#125;<br>);<br></code></pre></div></td></tr></table></figure>

<p>按条件查询一个：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">User.findOne(<br>  &#123;<br>    <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;AgoniLay&quot;</span>,<br>  &#125;,<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;查询失败&quot;</span>);<br>    <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;查询成功&quot;</span>);<br>      <span class="hljs-built_in">console</span>.log(data);<br>    &#125;<br>  &#125;<br>);<br></code></pre></div></td></tr></table></figure>

<h6 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h6><p>根据条件删除所有：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">User.remove(<br>  &#123;<br>    <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>  &#125;,<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;删除失败&quot;</span>);<br>    <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;删除成功&quot;</span>);<br>      <span class="hljs-built_in">console</span>.log(data);<br>    &#125;<br>  &#125;<br>);<br></code></pre></div></td></tr></table></figure>

<p>根据条件删除一个：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">Model.findOneAndRemove(conditions, [options], [callback]);<br></code></pre></div></td></tr></table></figure>

<p>根据 id 删除一个：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">Model.findByIdAndRemove(id, [options], [callback]);<br></code></pre></div></td></tr></table></figure>

<h6 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h6><p>根据条件更新所有：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">Model.update(conditions, doc, [options], [callback]);<br></code></pre></div></td></tr></table></figure>

<p>根据指定条件更新一个：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">Mode.findOneAndUpdate([conditions], [update], [options], [callback]);<br></code></pre></div></td></tr></table></figure>

<p>根据 id 更新一个：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">User.findByIdAndUpdate(<br>  <span class="hljs-string">&quot;6188a8f90f972021946da51e&quot;</span>,<br>  &#123;<br>    <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;020316&quot;</span>,<br>  &#125;,<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;更新失败&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;更新成功&quot;</span>);<br>      <span class="hljs-built_in">console</span>.log(data); <span class="hljs-comment">// 返回更改前数据</span><br>    &#125;<br>  &#125;<br>);<br></code></pre></div></td></tr></table></figure>

<h2 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h2><h3 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h3><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">x, y, callback</span>) </span>&#123;<br>  <span class="hljs-comment">// callback 就是回调函数</span><br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">var</span> ret = x + y;<br>    callback(ret);<br>  &#125;, <span class="hljs-number">1000</span>);<br>&#125;<br><br>add(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-function">(<span class="hljs-params">ret</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(ret);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>基于原生 XMLHttpRequest 封装 get 方法：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params">url, callback</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();<br>  xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    callback(xhr.responseText);<br>  &#125;;<br>  xhr.open(<span class="hljs-string">&quot;get&quot;</span>, url, <span class="hljs-literal">true</span>);<br>  xhr.send();<br>&#125;<br><br>get(<span class="hljs-string">&quot;data.json&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(data);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>callback hell（回调地狱）</p>
<img src="/2021/11/11/NodeJS%E9%BB%91%E9%A9%AC/callback-hell.jpeg" srcset="/img/loading2.gif" lazyload class title="callback-hell">

<p>无法保证顺序的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.readFile(<span class="hljs-string">&quot;./data/a.txt&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-comment">// return console.log(&#x27;读取失败&#x27;)</span><br>    <span class="hljs-comment">// 抛出异常</span><br>    <span class="hljs-comment">//  1. 阻止程序的执行</span><br>    <span class="hljs-comment">//  2. 把错误消息打印到控制台</span><br>    <span class="hljs-keyword">throw</span> err;<br>  &#125;<br>  <span class="hljs-built_in">console</span>.log(data);<br>&#125;);<br><br>fs.readFile(<span class="hljs-string">&quot;./data/b.txt&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-built_in">console</span>.log(data);<br>&#125;);<br><br>fs.readFile(<span class="hljs-string">&quot;./data/c.txt&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-built_in">console</span>.log(data);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>通过回调嵌套的方式来保证顺序：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.readFile(<span class="hljs-string">&quot;./data/a.txt&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>  <span class="hljs-built_in">console</span>.log(data);<br>  fs.readFile(<span class="hljs-string">&quot;./data/b.txt&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>    <span class="hljs-built_in">console</span>.log(data);<br>    fs.readFile(<span class="hljs-string">&quot;./data/c.txt&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<br>      <span class="hljs-built_in">console</span>.log(data);<br>    &#125;);<br>  &#125;);<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>为了解决以上编码方式带来的问题（回调地狱嵌套），所以在 ECMAScript 6 中新增了一个 API：<code>Primose</code></p>
<p>Promise 基本语法：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>&#123;<br>  fs.readFile(<span class="hljs-string">&quot;./data/a.txt&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-comment">// 失败了，承诺容器中的任务失败了</span><br>      <span class="hljs-comment">// console.log(err)</span><br>      <span class="hljs-comment">// 把容器的 pending 状态改为失败 rejected</span><br>      reject(err);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// 承诺容器中的任务成功了</span><br>      <span class="hljs-comment">// console.log(data)</span><br>      <span class="hljs-comment">// 把容器的 pending 状态改为成功 resolved</span><br>      resolve(data);<br>    &#125;<br>  &#125;);<br>&#125;);<br><br>promise.then(<br>  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(data);<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;读取文件失败了&quot;</span>, err);<br>  &#125;<br>);<br></code></pre></div></td></tr></table></figure>

<p>封装 Promise 版本的 <code>readFile</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pReadFile</span>(<span class="hljs-params">filePath</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>&#123;<br>    fs.readFile(filePath, <span class="hljs-string">&quot;utf8&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>      <span class="hljs-keyword">if</span> (err) &#123;<br>        reject(err);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        resolve(data);<br>      &#125;<br>    &#125;);<br>  &#125;);<br>&#125;<br><br>pReadFile(<span class="hljs-string">&quot;./data/a.txt&quot;</span>)<br>  .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(data);<br>    <span class="hljs-keyword">return</span> pReadFile(<span class="hljs-string">&quot;./data/b.txt&quot;</span>);<br>  &#125;)<br>  .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(data);<br>    <span class="hljs-keyword">return</span> pReadFile(<span class="hljs-string">&quot;./data/c.txt&quot;</span>);<br>  &#125;)<br>  .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(data);<br>  &#125;);<br></code></pre></div></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="代码风格"><a href="#代码风格" class="headerlink" title="代码风格"></a>代码风格</h3><ul>
<li>有分号风格</li>
<li>无分号风格<ul>
<li>只需要注意以 <code>(</code> <code>[</code> `` <code>开头的语句前面要加一个</code>;`</li>
</ul>
</li>
</ul>
<h3 id="修改代码自动重启"><a href="#修改代码自动重启" class="headerlink" title="修改代码自动重启"></a>修改代码自动重启</h3><p>使用第三方工具 nodemon 来解决频繁修改代码重启服务器问题</p>
<p><code>nodemon</code> 是一个基于 Node.js 开发的一个第三方命令行工具，需要独立安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install --global nodemon<br></code></pre></div></td></tr></table></figure>

<p>安装完毕后，使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">node app.js<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 使用 nodemon</span><br>nodemon app.js<br></code></pre></div></td></tr></table></figure>

<p>凡是通过 <code>nodemon</code> 启动的服务，则它会监视你文件的变化，当文件发生变化时，自动重启服务器。</p>
<h3 id="文件操作路径和模块路径"><a href="#文件操作路径和模块路径" class="headerlink" title="文件操作路径和模块路径"></a>文件操作路径和模块路径</h3><p>文件操作路径：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 在文件的相对路径中</span><br><span class="hljs-comment">//    ./ 和 不写 相对于当前目录</span><br><span class="hljs-comment">//    / 绝对路径，当前文件模块所处磁盘根目录</span><br><span class="hljs-comment">//    c:/xx 绝对路径</span><br><span class="hljs-comment">// Error: ENOENT: no such file or directory, open &#x27;F:\data\a.txt&#x27;</span><br>fs.readFile(<span class="hljs-string">&quot;/data/a.txt&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-built_in">console</span>.log(err);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;读取失败&quot;</span>);<br>  &#125;<br>  <span class="hljs-built_in">console</span>.log(data.toString());<br>&#125;);<br></code></pre></div></td></tr></table></figure>

<p>模块操作路径：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 这里如果忽略了 . 则也是磁盘根目录</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;/data/foo.js&quot;</span>);<br><br><span class="hljs-comment">// 相对路径</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./data/foo.js&quot;</span>);<br><br><span class="hljs-comment">// 模块加载的路径中的相对路径不能省略 ./</span><br></code></pre></div></td></tr></table></figure>

<h3 id="Node-js-操作-MySql-数据库"><a href="#Node-js-操作-MySql-数据库" class="headerlink" title="Node.js 操作 MySql 数据库"></a>Node.js 操作 MySql 数据库</h3><p>使用第三方包 <code>mysql</code></p>
<p>npm 网址：<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/mysql">https://www.npmjs.com/package/mysql</a></p>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install mysql --save<br></code></pre></div></td></tr></table></figure>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a>
                    
                      <a class="hover-with-bg" href="/tags/nodejs/">nodejs</a>
                    
                      <a class="hover-with-bg" href="/tags/express/">express</a>
                    
                      <a class="hover-with-bg" href="/tags/MongoDB/">MongoDB</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均为本人原创，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/11/11/JS%E6%A8%A1%E5%9D%97%E5%8C%96/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">JS模块化</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/08/axios%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0/">
                        <span class="hidden-mobile">axios 源码实现</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"fMlK1v2U3cjKJBIaYGEUd6iH-gzGzoHsz","appKey":"k49y92c0BEE6zL2mCA2AUHKu","placeholder":"说点什么","path":"window.location.pathname","avatar":"monsterid","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"https://fmlk1v2u.lc-cn-n1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"requiredFields":[]},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-x-md">
    <div class="container custom post-custom mx-auto">
      <img src="http://cdn.agonilay.top/agoni.gif" srcset="/img/loading2.gif" lazyload class="rounded mx-auto d-block mt-5" style="width:150px; height:150px;"> <h5 style="text-align: center; margin-top: 1rem;">谢谢您的光临噢！！！</h5> 
    </div>
  </div>


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <span>张宝文</span> ❤ <span>郑佳丽</span>  
	<!--《添加网站运行时间 -->
<br/>

<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
var now = new Date(); 

function createtime() {
    //此处修改你的建站时间或者网站上线时间
    var grt = new Date('07/28/2020 17:53:14');
    now.setTime(now.getTime() + 250);
    days = (now - grt) / 1000 / 60 / 60 / 24;

    dnum = Math.floor(days);
    hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum);
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
        hnum = "0" + hnum;
    }
    minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum);
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
        mnum = "0" + mnum;
    }
    seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
        snum = "0" + snum;
    }
    document.getElementById("timeDate").innerHTML = " 本站已安全运行 " + dnum + " 天 ";
    document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
}
setInterval("createtime()", 250);
</script>

<!-- 添加网站运行时间》-->
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>

  <script>
    function typing(id, title){
        var typed = new Typed('#' + id, {
            strings: [
              '  ',
              title + "&nbsp;",
            ],
            cursorChar: "❤",
            typeSpeed: 150,
            loop: false,
        });
        typed.stop();
        $(document).ready(function () {
            $(".typed-cursor").addClass("h2");
            typed.start();
        });
    }

    
        typing("subtitle", document.getElementById('subtitle').title)
    

  </script>













  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/yinghua.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>

<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>